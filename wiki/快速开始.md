# 快速开始

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [README_CN.md](file://README_CN.md)
- [docker/mongo/docker-compose.yml](file://docker/mongo/docker-compose.yml)
- [frontend/package.json](file://frontend/package.json)
- [pyproject.toml](file://pyproject.toml)
- [requirements.txt](file://requirements.txt)
- [mag/main.py](file://mag/main.py)
- [mag/app/core/config.py](file://mag/app/core/config.py)
- [frontend/vite.config.ts](file://frontend/vite.config.ts)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [部署步骤](#部署步骤)
   - [克隆仓库](#克隆仓库)
   - [安装前端依赖](#安装前端依赖)
   - [安装后端依赖](#安装后端依赖)
   - [配置环境变量](#配置环境变量)
   - [启动MongoDB容器](#启动mongodb容器)
   - [启动前端服务](#启动前端服务)
   - [启动后端服务](#启动后端服务)
4. [验证安装](#验证安装)
5. [常见问题排查](#常见问题排查)
6. [总结](#总结)

## 简介
本指南旨在帮助新用户快速在本地环境中部署并运行 `mcp-agent-graph-p` 项目。通过整合中英文 README 文件中的关键信息，提供一个连贯、清晰的操作流程，涵盖从克隆仓库到服务验证的完整过程。

## 项目结构概览
项目采用前后端分离架构：
- `frontend/`：前端代码，基于 Vite + React + TypeScript 构建
- `mag/`：后端核心代码，基于 FastAPI 框架
- `docker/mongo/`：MongoDB 容器化部署配置
- `sdk_demo/`：SDK 使用示例和演示数据

**Section sources**
- [README.md](file://README.md#L1-L237)
- [README_CN.md](file://README_CN.md#L1-L234)

## 部署步骤

### 克隆仓库
打开终端，执行以下命令克隆项目仓库：

```bash
git clone https://github.com/keta1930/mcp-agent-graph.git
cd mcp-agent-graph
```

此步骤获取项目全部源码，为后续部署做准备。

**Section sources**
- [README.md](file://README.md#L45-L47)
- [README_CN.md](file://README_CN.md#L45-L47)

### 安装前端依赖
进入前端目录并安装所需 npm 包：

```bash
cd frontend
npm install
```

该命令根据 `package.json` 文件安装所有前端依赖，包括 React、Ant Design、React Flow 等 UI 与交互库。

**Section sources**
- [README.md](file://README.md#L30-L34)
- [README_CN.md](file://README_CN.md#L30-L34)
- [frontend/package.json](file://frontend/package.json#L1-L59)

### 安装后端依赖
返回项目根目录，使用 Python 包管理工具安装后端依赖。推荐使用 `uv` 或 `pip`：

#### 使用 uv（推荐）
```bash
# 安装 uv（如未安装）
# 安装指南: https://docs.astral.sh/uv/getting-started/installation/

# 安装项目依赖
uv sync
# 激活虚拟环境（Windows PowerShell）
.venv\Scripts\activate.ps1
```

#### 使用 pip
```bash
pip install -r requirements.txt
```

后端依赖包括 FastAPI、Uvicorn、Motor（MongoDB 异步驱动）、LangChain 等核心库。

**Section sources**
- [README.md](file://README.md#L68-L84)
- [README_CN.md](file://README_CN.md#L68-L84)
- [requirements.txt](file://requirements.txt#L1-L14)
- [pyproject.toml](file://pyproject.toml#L1-L64)

### 配置环境变量
项目使用 `.env` 文件管理 MongoDB 连接配置。在 `docker/mongo/.env` 路径下创建环境变量文件，内容如下：

```env
# MongoDB 配置
MONGO_ROOT_USERNAME=admin
MONGO_ROOT_PASSWORD=securepassword123
MONGO_DATABASE=mcp-agent-graph
MONGO_PORT=27017

# Mongo Express Web UI 配置
MONGO_EXPRESS_USERNAME=admin
MONGO_EXPRESS_PASSWORD=expresspassword123
MONGO_EXPRESS_PORT=8081
```

这些变量将被 `docker-compose.yml` 和后端代码中的 `config.py` 读取，确保服务间通信一致。

**Section sources**
- [docker/mongo/docker-compose.yml](file://docker/mongo/docker-compose.yml#L1-L78)
- [mag/app/core/config.py](file://mag/app/core/config.py#L1-L102)

### 启动MongoDB容器
使用 Docker Compose 启动 MongoDB 及其 Web 管理界面 Mongo Express：

```bash
cd docker/mongo
docker-compose up -d
```

服务启动后：
- MongoDB 运行在 `localhost:27017`
- Mongo Express Web 界面可通过 `http://localhost:8081` 访问

**Section sources**
- [docker/mongo/docker-compose.yml](file://docker/mongo/docker-compose.yml#L1-L78)

### 启动前端服务
返回前端目录，启动开发服务器：

```bash
cd ../..
cd frontend
npm run dev
```

前端服务默认在 `http://localhost:5173` 启动。此配置由 `vite.config.ts` 定义。

**Section sources**
- [README.md](file://README.md#L35-L37)
- [README_CN.md](file://README_CN.md#L35-L37)
- [frontend/vite.config.ts](file://frontend/vite.config.ts#L1-L8)

### 启动后端服务
进入后端主目录并启动 FastAPI 应用：

```bash
cd mag
python main.py
```

后端服务将在 `http://0.0.0.0:9999` 启动，MCP 客户端监听端口 `8765`。`main.py` 中的 `startup_event` 会初始化文件系统、模型服务、图服务及 MongoDB 连接。

**Section sources**
- [README.md](file://README.md#L78-L84)
- [README_CN.md](file://README_CN.md#L78-L84)
- [mag/main.py](file://mag/main.py#L1-L120)
- [mag/app/core/config.py](file://mag/app/core/config.py#L1-L102)

## 验证安装
完成上述步骤后，进行以下验证：

1. **前端访问**：打开浏览器访问 `http://localhost:5173`，应能看到可视化图编辑器界面。
2. **后端健康检查**：访问 `http://localhost:9999/health`，返回 JSON 响应：
   ```json
   {"status": "healthy", "app_name": "MAG - MCP Agent Graph", "version": "2.0.0"}
   ```
3. **数据库连接**：访问 `http://localhost:8081`，使用 `.env` 中配置的用户名密码登录，确认 `mcp-agent-graph` 数据库存在。
4. **功能测试**：在前端导入 `sdk_demo/deepresearch.zip` 示例，运行以验证图执行功能。

**Section sources**
- [README.md](file://README.md#L108-L110)
- [README_CN.md](file://README_CN.md#L108-L110)

## 常见问题排查

### 端口冲突
- **现象**：服务启动失败，提示端口被占用。
- **解决方案**：
  - 检查 `docker/mongo/.env` 中的 `MONGO_PORT` 和 `MONGO_EXPRESS_PORT` 是否与其他服务冲突。
  - 修改 `mag/main.py` 中的 `port=9999` 为其他端口。
  - 使用 `netstat -ano | findstr :端口号`（Windows）或 `lsof -i :端口号`（Linux/macOS）查找并终止占用进程。

### 依赖安装失败
- **现象**：`npm install` 或 `pip install` 报错。
- **解决方案**：
  - 确保 Node.js（v18+）和 Python（v3.11+）已正确安装。
  - 使用国内镜像源加速，如 `pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple`。
  - 对于 `uv`，确保已正确安装并激活虚拟环境。

### 数据库连接错误
- **现象**：后端日志显示 MongoDB 连接失败。
- **解决方案**：
  - 确认 `docker-compose up` 已成功启动 MongoDB 容器。
  - 检查 `.env` 文件中的用户名、密码、端口是否与 `docker-compose.yml` 一致。
  - 验证 `MONGODB_URL` 环境变量是否正确生成（可在 `config.py` 中打印调试）。

### 环境变量未加载
- **现象**：服务无法读取配置。
- **解决方案**：
  - 确保 `.env` 文件位于 `docker/mongo/.env` 路径。
  - `config.py` 会自动加载该路径的环境变量，无需手动调用 `load_dotenv()` 在其他位置。

**Section sources**
- [README.md](file://README.md#L30-L110)
- [README_CN.md](file://README_CN.md#L30-L110)
- [docker/mongo/docker-compose.yml](file://docker/mongo/docker-compose.yml#L1-L78)
- [mag/app/core/config.py](file://mag/app/core/config.py#L1-L102)

## 总结
本指南整合了 `mcp-agent-graph-p` 项目的中英文部署说明，提供了一套完整的本地部署流程。通过克隆仓库、安装依赖、配置环境、启动服务等步骤，用户可快速搭建开发环境。建议使用 `uv` 作为 Python 包管理工具，并通过 `deepresearch.zip` 示例验证系统功能。遇到问题时，可参考常见问题排查方案或查阅项目文档。