<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè¯ç®¡ç† - MAG SDK ä½¿ç”¨æ–‡æ¡£</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 280px;
            background: #fff;
            border-right: 1px solid #e1e5e9;
            padding: 20px 0;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 20px;
        }

        .logo h1 {
            color: #2563eb;
            font-size: 24px;
            font-weight: 700;
        }

        .logo p {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }

        .nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.2s;
            border-right: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: #f3f4f6;
            color: #2563eb;
        }

        .nav-link.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-right-color: #2563eb;
        }

        .nav-link i {
            margin-right: 10px;
            width: 16px;
        }

        /* æŠ˜å èœå•æ ·å¼ */
        .nav-group {
            margin-bottom: 10px;
        }

        .nav-group-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            color: #374151;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-group-title:hover {
            background-color: #f9fafb;
            color: #2563eb;
        }

        .nav-group-title.active {
            background-color: #eff6ff;
            color: #2563eb;
        }

        .nav-group-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-group-content .nav-link {
            padding-left: 50px;
            font-size: 14px;
        }

        .chevron {
            transition: transform 0.3s ease;
            transform: rotate(90deg);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px 60px;
            background: #fff;
            min-height: 100vh;
        }

        /* é¡µé¢å¤´éƒ¨ */
        .page-header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .page-header h1 {
            color: #1f2937;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* å†…å®¹åŒºå— */
        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #1f2937;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #374151;
            font-size: 1.3rem;
            margin: 30px 0 15px;
        }

        .section p {
            color: #6b7280;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* ä»£ç å—æ ·å¼ */
        .code-block {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4b5563;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #6b7280;
        }

        /* åŠŸèƒ½å¡ç‰‡ */
        .function-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            transition: all 0.3s ease;
        }

        .function-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .function-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .function-icon {
            background: #2563eb;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .function-title {
            color: #1f2937;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* å‚æ•°è¡¨æ ¼ */
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .param-table th,
        .param-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .param-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .param-table tr:last-child td {
            border-bottom: none;
        }

        /* è¿”å›å€¼æ ·å¼ */
        .return-value {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .return-value h4 {
            color: #065f46;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .return-value p {
            color: #047857;
            margin: 0;
        }

        /* æ³¨æ„äº‹é¡¹ */
        .note {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .note h4 {
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note p {
            color: #b45309;
            margin: 0;
        }

        /* ç›®å½•å¯¼èˆª */
        .toc {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc h3 {
            color: #374151;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #2563eb;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .toc a:hover {
            background: #eff6ff;
        }

        /* ä¼šè¯å¡ç‰‡æ ·å¼ */
        .conversation-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .conversation-id {
            font-family: monospace;
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .conversation-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .status-running {
            background: #fef3c7;
            color: #92400e;
        }

        .status-error {
            background: #fee2e2;
            color: #dc2626;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .page-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <nav class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-project-diagram"></i> MAG SDK</h1>
                <p>MCP Agent Graph å¼€å‘æ¡†æ¶</p>
            </div>
            
            <ul class="nav">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        æ¦‚è¿°
                    </a>
                </li>
                
                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-cog"></i> ç³»ç»Ÿç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="system.html#system-start" class="nav-link">
                            <i class="fas fa-play"></i>
                            å¯åŠ¨æœåŠ¡
                        </a>
                        <a href="system.html#system-status" class="nav-link">
                            <i class="fas fa-info-circle"></i>
                            çŠ¶æ€æ£€æŸ¥
                        </a>
                        <a href="system.html#system-shutdown" class="nav-link">
                            <i class="fas fa-stop"></i>
                            å…³é—­æœåŠ¡
                        </a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-project-diagram"></i> å›¾ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="graph.html#graph-list" class="nav-link">åˆ—å‡ºå›¾</a>
                        <a href="graph.html#graph-get" class="nav-link">è·å–å›¾</a>
                        <a href="graph.html#graph-save" class="nav-link">ä¿å­˜å›¾</a>
                        <a href="graph.html#graph-delete" class="nav-link">åˆ é™¤å›¾</a>
                        <a href="graph.html#graph-run" class="nav-link">è¿è¡Œå›¾</a>
                        <a href="graph.html#graph-import" class="nav-link">å¯¼å…¥å›¾</a>
                        <a href="graph.html#graph-export" class="nav-link">å¯¼å‡ºå›¾</a>
                        <a href="graph.html#graph-mcp" class="nav-link">ç”ŸæˆMCPè„šæœ¬</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-brain"></i> æ¨¡å‹ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="model.html#model-list" class="nav-link">åˆ—å‡ºæ¨¡å‹</a>
                        <a href="model.html#model-add" class="nav-link">æ·»åŠ æ¨¡å‹</a>
                        <a href="model.html#model-update" class="nav-link">æ›´æ–°æ¨¡å‹</a>
                        <a href="model.html#model-delete" class="nav-link">åˆ é™¤æ¨¡å‹</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-server"></i> MCPç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="mcp.html#mcp-config" class="nav-link">é…ç½®ç®¡ç†</a>
                        <a href="mcp.html#mcp-status" class="nav-link">çŠ¶æ€æŸ¥çœ‹</a>
                        <a href="mcp.html#mcp-connect" class="nav-link">è¿æ¥æœåŠ¡å™¨</a>
                        <a href="mcp.html#mcp-tools" class="nav-link">å·¥å…·ç®¡ç†</a>
                        <a href="mcp.html#mcp-servers" class="nav-link">æœåŠ¡å™¨ç®¡ç†</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title active">
                        <span><i class="fas fa-comments"></i> ä¼šè¯ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content">
                        <a href="#conversation-list" class="nav-link active">åˆ—å‡ºä¼šè¯</a>
                        <a href="#conversation-get" class="nav-link">è·å–ä¼šè¯</a>
                        <a href="#conversation-delete" class="nav-link">åˆ é™¤ä¼šè¯</a>
                        <a href="#conversation-hierarchy" class="nav-link">ä¼šè¯å±‚æ¬¡ç»“æ„</a>
                    </div>
                </li>

                <li class="nav-item">
                    <a href="examples.html" class="nav-link">
                        <i class="fas fa-code"></i>
                        ç¤ºä¾‹æ•™ç¨‹
                    </a>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="page-header">
                <h1><i class="fas fa-comments"></i> ä¼šè¯ç®¡ç†</h1>
                <p>æ™ºèƒ½ä½“æ‰§è¡Œä¼šè¯çš„æŸ¥çœ‹ã€ç®¡ç†å’Œæ“ä½œ</p>
            </div>

            <!-- ç›®å½•å¯¼èˆª -->
            <div class="toc">
                <h3><i class="fas fa-list"></i> æœ¬é¡µå†…å®¹</h3>
                <ul>
                    <li><a href="#conversation-list">åˆ—å‡ºä¼šè¯ - mag.list_conversations()</a></li>
                    <li><a href="#conversation-get">è·å–ä¼šè¯ - mag.get_conversation()</a></li>
                    <li><a href="#conversation-delete">åˆ é™¤ä¼šè¯ - mag.delete_conversation()</a></li>
                    <li><a href="#conversation-hierarchy">ä¼šè¯å±‚æ¬¡ç»“æ„ - mag.get_conversation_hierarchy()</a></li>
                </ul>
            </div>

            <!-- åˆ—å‡ºä¼šè¯ -->
            <section class="section" id="conversation-list">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="function-title">mag.list_conversations()</div>
                    </div>
                    
                    <p>è·å–ç³»ç»Ÿä¸­æ‰€æœ‰ä¿å­˜çš„ä¼šè¯åˆ—è¡¨ã€‚ä¼šè¯æ˜¯æ™ºèƒ½ä½“å›¾æ‰§è¡Œçš„è®°å½•ï¼ŒåŒ…å«è¾“å…¥ã€è¾“å‡ºå’Œä¸­é—´è¿‡ç¨‹ã€‚</p>

                    <h3>å‡½æ•°ç­¾å</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def list_conversations() -> List[str]:
    """
    åˆ—å‡ºæ‰€æœ‰ä¼šè¯
    
    è¿”å›:
        List[str]: ä¼šè¯IDåˆ—è¡¨
    """</code></pre>
                    </div>

                    <h3>è¿”å›å€¼</h3>
                    <div class="return-value">
                        <h4><i class="fas fa-check-circle"></i> è¿”å›å€¼è¯´æ˜</h4>
                        <p><strong>List[str]</strong> - åŒ…å«æ‰€æœ‰ä¼šè¯IDçš„å­—ç¬¦ä¸²åˆ—è¡¨</p>
                    </div>

                    <h3>ä½¿ç”¨ç¤ºä¾‹</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag

# å¯åŠ¨æœåŠ¡
mag.start()

# è·å–æ‰€æœ‰ä¼šè¯åˆ—è¡¨
conversations = mag.list_conversations()
print(f"ç³»ç»Ÿä¸­å…±æœ‰ {len(conversations)} ä¸ªä¼šè¯:")

# æ˜¾ç¤ºä¼šè¯åˆ—è¡¨
for i, conv_id in enumerate(conversations, 1):
    print(f"{i}. {conv_id}")

# ç¤ºä¾‹è¾“å‡º:
# ç³»ç»Ÿä¸­å…±æœ‰ 3 ä¸ªä¼šè¯:
# 1. conv_20241215_143022_abc123
# 2. conv_20241215_145030_def456  
# 3. conv_20241215_150145_ghi789
</code></pre>
                    </div>

                    <h3>ä¼šè¯ä¿¡æ¯å±•ç¤º</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def display_conversations_summary():
    """æ˜¾ç¤ºä¼šè¯æ‘˜è¦ä¿¡æ¯"""
    conversations = mag.list_conversations()
    
    if not conversations:
        print("ğŸ“­ å½“å‰æ²¡æœ‰ä¿å­˜çš„ä¼šè¯")
        return
    
    print(f"ğŸ“‹ ä¼šè¯æ‘˜è¦ (å…± {len(conversations)} ä¸ªä¼šè¯):")
    print("-" * 60)
    
    for i, conv_id in enumerate(conversations, 1):
        try:
            # è·å–ä¼šè¯è¯¦æƒ…
            conv_detail = mag.get_conversation(conv_id)
            
            print(f"\n{i}. ä¼šè¯ {conv_id}")
            print(f"   å›¾åç§°: {conv_detail.get('graph_name', 'æœªçŸ¥')}")
            print(f"   çŠ¶æ€: {conv_detail.get('status', 'æœªçŸ¥')}")
            
            # æ˜¾ç¤ºè¾“å‡ºæ‘˜è¦ï¼ˆå‰100ä¸ªå­—ç¬¦ï¼‰
            output = conv_detail.get('output', '')
            if output:
                output_preview = output[:100] + "..." if len(output) > 100 else output
                print(f"   è¾“å‡ºé¢„è§ˆ: {output_preview}")
            
            # æ˜¾ç¤ºé™„ä»¶ä¿¡æ¯
            attachments = conv_detail.get('attachments', [])
            if attachments:
                print(f"   é™„ä»¶: {len(attachments)} ä¸ªæ–‡ä»¶")
                
        except Exception as e:
            print(f"   é”™è¯¯: æ— æ³•è·å–ä¼šè¯è¯¦æƒ… - {e}")

# æ˜¾ç¤ºä¼šè¯æ‘˜è¦
display_conversations_summary()
</code></pre>
                    </div>

                    <h3>æŒ‰æ—¶é—´æ’åºæ˜¾ç¤º</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import re
from datetime import datetime

def parse_conversation_timestamp(conv_id):
    """ä»ä¼šè¯IDä¸­è§£ææ—¶é—´æˆ³"""
    # å‡è®¾ä¼šè¯IDæ ¼å¼ä¸º: conv_YYYYMMDD_HHMMSS_xxx
    match = re.search(r'conv_(\d{8})_(\d{6})_', conv_id)
    if match:
        date_str = match.group(1)
        time_str = match.group(2)
        try:
            return datetime.strptime(f"{date_str}_{time_str}", "%Y%m%d_%H%M%S")
        except:
            pass
    return None

def display_conversations_by_time():
    """æŒ‰æ—¶é—´æ’åºæ˜¾ç¤ºä¼šè¯"""
    conversations = mag.list_conversations()
    
    # è§£ææ—¶é—´æˆ³å¹¶æ’åº
    conv_with_time = []
    conv_without_time = []
    
    for conv_id in conversations:
        timestamp = parse_conversation_timestamp(conv_id)
        if timestamp:
            conv_with_time.append((timestamp, conv_id))
        else:
            conv_without_time.append(conv_id)
    
    # æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
    conv_with_time.sort(key=lambda x: x[0], reverse=True)
    
    print("ğŸ“… æŒ‰æ—¶é—´æ’åºçš„ä¼šè¯åˆ—è¡¨:")
    print("-" * 50)
    
    # æ˜¾ç¤ºæœ‰æ—¶é—´æˆ³çš„ä¼šè¯
    for timestamp, conv_id in conv_with_time:
        formatted_time = timestamp.strftime("%Y-%m-%d %H:%M:%S")
        print(f"ğŸ•’ {formatted_time} - {conv_id}")
    
    # æ˜¾ç¤ºæ— æ³•è§£ææ—¶é—´çš„ä¼šè¯
    if conv_without_time:
        print("\nğŸ“„ å…¶ä»–ä¼šè¯:")
        for conv_id in conv_without_time:
            print(f"   {conv_id}")

# æŒ‰æ—¶é—´æ˜¾ç¤ºä¼šè¯
display_conversations_by_time()
</code></pre>
                    </div>
                </div>
            </section>

            <!-- è·å–ä¼šè¯ -->
            <section class="section" id="conversation-get">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="function-title">mag.get_conversation()</div>
                    </div>
                    
                    <p>è·å–æŒ‡å®šä¼šè¯çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰§è¡Œç»“æœã€è¾“å‡ºå†…å®¹ã€é™„ä»¶ç­‰ã€‚</p>

                    <h3>å‡½æ•°ç­¾å</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def get_conversation(conversation_id: str) -> Dict[str, Any]:
    """
    è·å–ä¼šè¯çŠ¶æ€
    
    å‚æ•°:
        conversation_id (str): ä¼šè¯ID
    
    è¿”å›:
        Dict[str, Any]: ä¼šè¯çŠ¶æ€
    """</code></pre>
                    </div>

                    <h3>å‚æ•°è¯´æ˜</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>å‚æ•°å</th>
                                <th>ç±»å‹</th>
                                <th>å¿…éœ€</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>conversation_id</td>
                                <td>str</td>
                                <td>æ˜¯</td>
                                <td>è¦è·å–çš„ä¼šè¯ID</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>ä½¿ç”¨ç¤ºä¾‹</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag

# è·å–ç‰¹å®šä¼šè¯ä¿¡æ¯
conv_id = "conv_20241215_143022_abc123"
conversation = mag.get_conversation(conv_id)

print(f"ä¼šè¯ID: {conv_id}")
print(f"å›¾åç§°: {conversation.get('graph_name', 'æœªçŸ¥')}")
print(f"çŠ¶æ€: {conversation.get('status', 'æœªçŸ¥')}")

# æ˜¾ç¤ºè¾“å‡ºå†…å®¹
output = conversation.get('output', '')
if output:
    print(f"\nğŸ“„ è¾“å‡ºå†…å®¹:")
    print(output)

# æ˜¾ç¤ºé™„ä»¶ä¿¡æ¯
attachments = conversation.get('attachments', [])
if attachments:
    print(f"\nğŸ“ é™„ä»¶ ({len(attachments)} ä¸ª):")
    for attachment in attachments:
        print(f"   â€¢ {attachment['name']} ({attachment['type']})")
        print(f"     è·¯å¾„: {attachment['path']}")
        print(f"     å¤§å°: {attachment.get('size', 'Unknown')} å­—èŠ‚")

# æ˜¾ç¤ºèŠ‚ç‚¹æ‰§è¡Œç»“æœ
if 'node_results' in conversation:
    print(f"\nğŸ”§ èŠ‚ç‚¹æ‰§è¡Œç»“æœ:")
    for node_id, result in conversation['node_results'].items():
        print(f"   èŠ‚ç‚¹: {node_id}")
        print(f"   çŠ¶æ€: {result.get('status', 'æœªçŸ¥')}")
        if result.get('output'):
            output_preview = result['output'][:150] + "..." if len(result['output']) > 150 else result['output']
            print(f"   è¾“å‡º: {output_preview}")
</code></pre>
                    </div>

                    <h3>å¤„ç†é™„ä»¶å†…å®¹</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def display_conversation_attachments(conv_id):
    """æ˜¾ç¤ºä¼šè¯é™„ä»¶å¹¶å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶"""
    conversation = mag.get_conversation(conv_id)
    attachments = conversation.get('attachments', [])
    
    if not attachments:
        print("ğŸ“­ æ­¤ä¼šè¯æ²¡æœ‰é™„ä»¶")
        return
    
    print(f"ğŸ“ ä¼šè¯ {conv_id} çš„é™„ä»¶:")
    print("-" * 50)
    
    for i, attachment in enumerate(attachments, 1):
        file_name = attachment['name']
        file_type = attachment['type'].lower()
        file_path = attachment['path']
        
        print(f"\n{i}. {file_name} ({file_type.upper()})")
        print(f"   è·¯å¾„: {file_path}")
        print(f"   å¤§å°: {attachment.get('size', 'Unknown')} å­—èŠ‚")
        
        # æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºå†…å®¹é¢„è§ˆ
        try:
            if file_type in ['md', 'txt']:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()
                    preview = content[:300] + "..." if len(content) > 300 else content
                    print(f"   é¢„è§ˆ:\n{preview}")
            
            elif file_type == 'json':
                with open(file_path, 'r', encoding='utf-8') as f:
                    import json
                    data = json.load(f)
                    print(f"   JSONç»“æ„: {type(data).__name__}")
                    if isinstance(data, dict):
                        print(f"   é”®æ•°é‡: {len(data)}")
                    elif isinstance(data, list):
                        print(f"   å…ƒç´ æ•°é‡: {len(data)}")
            
            elif file_type in ['jpg', 'png', 'gif', 'pdf']:
                print(f"   ç±»å‹: {file_type.upper()} æ–‡ä»¶")
                print("   æç¤º: éœ€è¦ä½¿ç”¨å¯¹åº”çš„åº”ç”¨ç¨‹åºæ‰“å¼€")
                
        except Exception as e:
            print(f"   é”™è¯¯: æ— æ³•è¯»å–æ–‡ä»¶ - {e}")

# æ˜¾ç¤ºä¼šè¯é™„ä»¶
conversations = mag.list_conversations()
if conversations:
    display_conversation_attachments(conversations[0])
</code></pre>
                    </div>

                    <h3>ä¼šè¯ç»“æœåˆ†æ</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def analyze_conversation_performance(conv_id):
    """åˆ†æä¼šè¯çš„æ‰§è¡Œæ€§èƒ½å’Œç»“æœ"""
    conversation = mag.get_conversation(conv_id)
    
    print(f"ğŸ“Š ä¼šè¯ {conv_id} æ€§èƒ½åˆ†æ:")
    print("-" * 50)
    
    # åŸºæœ¬ä¿¡æ¯
    print(f"å›¾åç§°: {conversation.get('graph_name', 'æœªçŸ¥')}")
    print(f"æ‰§è¡ŒçŠ¶æ€: {conversation.get('status', 'æœªçŸ¥')}")
    
    # èŠ‚ç‚¹åˆ†æ
    node_results = conversation.get('node_results', {})
    if node_results:
        total_nodes = len(node_results)
        successful_nodes = sum(1 for result in node_results.values() 
                              if result.get('status') == 'success')
        
        print(f"\nğŸ”§ èŠ‚ç‚¹æ‰§è¡Œç»Ÿè®¡:")
        print(f"   æ€»èŠ‚ç‚¹æ•°: {total_nodes}")
        print(f"   æˆåŠŸèŠ‚ç‚¹: {successful_nodes}")
        print(f"   æˆåŠŸç‡: {successful_nodes/total_nodes*100:.1f}%")
        
        # æ˜¾ç¤ºå¤±è´¥çš„èŠ‚ç‚¹
        failed_nodes = [node_id for node_id, result in node_results.items() 
                       if result.get('status') != 'success']
        if failed_nodes:
            print(f"   å¤±è´¥èŠ‚ç‚¹: {failed_nodes}")
    
    # è¾“å‡ºåˆ†æ
    output = conversation.get('output', '')
    if output:
        print(f"\nğŸ“„ è¾“å‡ºåˆ†æ:")
        print(f"   è¾“å‡ºé•¿åº¦: {len(output)} å­—ç¬¦")
        print(f"   è¡Œæ•°: {output.count('\\n') + 1}")
    
    # é™„ä»¶åˆ†æ
    attachments = conversation.get('attachments', [])
    if attachments:
        print(f"\nğŸ“ é™„ä»¶åˆ†æ:")
        print(f"   é™„ä»¶æ•°é‡: {len(attachments)}")
        
        total_size = sum(att.get('size', 0) for att in attachments)
        print(f"   æ€»å¤§å°: {total_size:,} å­—èŠ‚")
        
        file_types = {}
        for att in attachments:
            file_type = att['type']
            file_types[file_type] = file_types.get(file_type, 0) + 1
        
        print(f"   æ–‡ä»¶ç±»å‹åˆ†å¸ƒ:")
        for file_type, count in file_types.items():
            print(f"     {file_type}: {count} ä¸ª")

# åˆ†æä¼šè¯æ€§èƒ½
conversations = mag.list_conversations()
if conversations:
    analyze_conversation_performance(conversations[0])
</code></pre>
                    </div>
                </div>
            </section>

            <!-- åˆ é™¤ä¼šè¯ -->
            <section class="section" id="conversation-delete">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="function-title">mag.delete_conversation()</div>
                    </div>
                    
                    <p>åˆ é™¤æŒ‡å®šçš„ä¼šè¯åŠå…¶ç›¸å…³æ–‡ä»¶ã€‚æ­¤æ“ä½œä¼šæ°¸ä¹…åˆ é™¤ä¼šè¯æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œã€‚</p>

                    <h3>å‡½æ•°ç­¾å</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def delete_conversation(conversation_id: str) -> Dict[str, Any]:
    """
    åˆ é™¤ä¼šè¯
    
    å‚æ•°:
        conversation_id (str): ä¼šè¯ID
    
    è¿”å›:
        Dict[str, Any]: æ“ä½œç»“æœ
    """</code></pre>
                    </div>

                    <h3>ä½¿ç”¨ç¤ºä¾‹</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag

# åˆ é™¤å•ä¸ªä¼šè¯
conv_id = "conv_20241215_143022_abc123"
result = mag.delete_conversation(conv_id)
print(f"åˆ é™¤ç»“æœ: {result}")

# å®‰å…¨åˆ é™¤ï¼ˆå¸¦ç¡®è®¤ï¼‰
def safe_delete_conversation(conv_id):
    """å®‰å…¨åœ°åˆ é™¤ä¼šè¯ï¼ŒåŒ…å«ç¡®è®¤æ­¥éª¤"""
    try:
        # è·å–ä¼šè¯ä¿¡æ¯
        conversation = mag.get_conversation(conv_id)
        
        print(f"å³å°†åˆ é™¤ä¼šè¯: {conv_id}")
        print(f"å›¾åç§°: {conversation.get('graph_name', 'æœªçŸ¥')}")
        print(f"çŠ¶æ€: {conversation.get('status', 'æœªçŸ¥')}")
        
        # æ˜¾ç¤ºé™„ä»¶ä¿¡æ¯
        attachments = conversation.get('attachments', [])
        if attachments:
            print(f"é™„ä»¶æ•°é‡: {len(attachments)} ä¸ª")
            total_size = sum(att.get('size', 0) for att in attachments)
            print(f"æ€»å¤§å°: {total_size:,} å­—èŠ‚")
        
        # ç¡®è®¤åˆ é™¤
        confirm = input("ç¡®è®¤åˆ é™¤æ­¤ä¼šè¯åŠæ‰€æœ‰ç›¸å…³æ–‡ä»¶? (yes/no): ")
        if confirm.lower() == 'yes':
            result = mag.delete_conversation(conv_id)
            if result.get("status") == "success":
                print(f"âœ… ä¼šè¯ '{conv_id}' å·²åˆ é™¤")
                return True
            else:
                print(f"âŒ åˆ é™¤å¤±è´¥: {result.get('message', 'Unknown error')}")
                return False
        else:
            print("å–æ¶ˆåˆ é™¤æ“ä½œ")
            return False
            
    except Exception as e:
        print(f"åˆ é™¤è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
        return False

# ä½¿ç”¨å®‰å…¨åˆ é™¤
safe_delete_conversation("conv_20241215_143022_abc123")
</code></pre>
                    </div>

                    <h3>æ‰¹é‡åˆ é™¤ä¼šè¯</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def batch_delete_conversations(conversation_ids, confirm=True):
    """æ‰¹é‡åˆ é™¤ä¼šè¯"""
    if not conversation_ids:
        print("æ²¡æœ‰ä¼šè¯éœ€è¦åˆ é™¤")
        return
    
    if confirm:
        print(f"å³å°†åˆ é™¤ {len(conversation_ids)} ä¸ªä¼šè¯:")
        for conv_id in conversation_ids:
            try:
                conv = mag.get_conversation(conv_id)
                print(f"  â€¢ {conv_id} - {conv.get('graph_name', 'æœªçŸ¥å›¾')}")
            except:
                print(f"  â€¢ {conv_id} - æ— æ³•è·å–è¯¦æƒ…")
        
        confirm_input = input("ç¡®è®¤æ‰¹é‡åˆ é™¤? (yes/no): ")
        if confirm_input.lower() != 'yes':
            print("å–æ¶ˆæ‰¹é‡åˆ é™¤æ“ä½œ")
            return
    
    results = []
    for conv_id in conversation_ids:
        try:
            result = mag.delete_conversation(conv_id)
            if result.get("status") == "success":
                print(f"âœ… åˆ é™¤ '{conv_id}' æˆåŠŸ")
                results.append({"id": conv_id, "status": "success"})
            else:
                print(f"âŒ åˆ é™¤ '{conv_id}' å¤±è´¥: {result.get('message', 'Unknown error')}")
                results.append({"id": conv_id, "status": "failed", "message": result.get('message', '')})
        except Exception as e:
            print(f"âŒ åˆ é™¤ '{conv_id}' å‡ºé”™: {e}")
            results.append({"id": conv_id, "status": "error", "message": str(e)})
    
    successful = sum(1 for r in results if r["status"] == "success")
    print(f"\næ‰¹é‡åˆ é™¤å®Œæˆ: æˆåŠŸ {successful}/{len(conversation_ids)} ä¸ª")
    return results

# æ‰¹é‡åˆ é™¤ç¤ºä¾‹
conversations_to_delete = ["conv_1", "conv_2", "conv_3"]
batch_delete_conversations(conversations_to_delete)
</code></pre>
                    </div>

                    <h3>æ¸…ç†æ—§ä¼šè¯</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">from datetime import datetime, timedelta

def cleanup_old_conversations(days_old=30, dry_run=True):
    """æ¸…ç†æŒ‡å®šå¤©æ•°å‰çš„æ—§ä¼šè¯"""
    conversations = mag.list_conversations()
    cutoff_date = datetime.now() - timedelta(days=days_old)
    
    old_conversations = []
    
    for conv_id in conversations:
        timestamp = parse_conversation_timestamp(conv_id)
        if timestamp and timestamp < cutoff_date:
            old_conversations.append((conv_id, timestamp))
    
    if not old_conversations:
        print(f"æ²¡æœ‰æ‰¾åˆ° {days_old} å¤©å‰çš„ä¼šè¯")
        return
    
    # æŒ‰æ—¶é—´æ’åº
    old_conversations.sort(key=lambda x: x[1])
    
    print(f"å‘ç° {len(old_conversations)} ä¸ªè¶…è¿‡ {days_old} å¤©çš„ä¼šè¯:")
    total_size = 0
    
    for conv_id, timestamp in old_conversations:
        try:
            conv = mag.get_conversation(conv_id)
            attachments = conv.get('attachments', [])
            conv_size = sum(att.get('size', 0) for att in attachments)
            total_size += conv_size
            
            formatted_time = timestamp.strftime("%Y-%m-%d %H:%M")
            print(f"  â€¢ {conv_id} ({formatted_time}) - {conv_size:,} å­—èŠ‚")
        except:
            print(f"  â€¢ {conv_id} - æ— æ³•è·å–è¯¦æƒ…")
    
    print(f"\næ€»è®¡å¤§å°: {total_size:,} å­—èŠ‚ ({total_size/1024/1024:.1f} MB)")
    
    if dry_run:
        print("\nè¿™æ˜¯é¢„è§ˆæ¨¡å¼ï¼Œæ²¡æœ‰å®é™…åˆ é™¤ä»»ä½•æ–‡ä»¶")
        print("è¦æ‰§è¡Œå®é™…åˆ é™¤ï¼Œè¯·è®¾ç½® dry_run=False")
        return
    
    # ç¡®è®¤åˆ é™¤
    confirm = input(f"ç¡®è®¤åˆ é™¤è¿™ {len(old_conversations)} ä¸ªæ—§ä¼šè¯? (yes/no): ")
    if confirm.lower() == 'yes':
        conv_ids = [conv_id for conv_id, _ in old_conversations]
        batch_delete_conversations(conv_ids, confirm=False)
    else:
        print("å–æ¶ˆæ¸…ç†æ“ä½œ")

# é¢„è§ˆ30å¤©å‰çš„ä¼šè¯ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
cleanup_old_conversations(days_old=30, dry_run=True)

# å®é™…æ¸…ç†ï¼ˆå»é™¤dry_runå‚æ•°æˆ–è®¾ä¸ºFalseï¼‰
# cleanup_old_conversations(days_old=30, dry_run=False)
</code></pre>
                    </div>

                    <div class="note">
                        <h4><i class="fas fa-exclamation-triangle"></i> åˆ é™¤æ³¨æ„äº‹é¡¹</h4>
                        <p>â€¢ åˆ é™¤æ“ä½œä¸å¯é€†ï¼Œè¯·åŠ¡å¿…è°¨æ…<br>
                        â€¢ åˆ é™¤ä¼šè¯ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰ç›¸å…³çš„é™„ä»¶æ–‡ä»¶<br>
                        â€¢ å»ºè®®åœ¨åˆ é™¤å‰å¤‡ä»½é‡è¦çš„ä¼šè¯æ•°æ®<br>
                        â€¢ æ‰¹é‡åˆ é™¤æ—¶å»ºè®®å…ˆä½¿ç”¨é¢„è§ˆæ¨¡å¼ç¡®è®¤</p>
                    </div>
                </div>
            </section>

            <!-- ä¼šè¯å±‚æ¬¡ç»“æ„ -->
            <section class="section" id="conversation-hierarchy">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                        <div class="function-title">mag.get_conversation_hierarchy()</div>
                    </div>
                    
                    <p>è·å–ä¼šè¯çš„å±‚æ¬¡ç»“æ„ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºåŒ…å«åµŒå¥—å›¾æ‰§è¡Œçš„å¤æ‚ä¼šè¯ã€‚</p>

                    <h3>å‡½æ•°ç­¾å</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def get_conversation_hierarchy(conversation_id: str) -> Dict[str, Any]:
    """
    è·å–ä¼šè¯å±‚æ¬¡ç»“æ„
    
    å‚æ•°:
        conversation_id (str): ä¼šè¯ID
    
    è¿”å›:
        Dict[str, Any]: ä¼šè¯å±‚æ¬¡ç»“æ„
    """</code></pre>
                    </div>

                    <h3>ä½¿ç”¨ç¤ºä¾‹</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag

# è·å–ä¼šè¯å±‚æ¬¡ç»“æ„
conv_id = "conv_20241215_143022_abc123"
hierarchy = mag.get_conversation_hierarchy(conv_id)

print(f"ä¼šè¯å±‚æ¬¡ç»“æ„: {conv_id}")
print("-" * 50)

def display_hierarchy(data, level=0):
    """é€’å½’æ˜¾ç¤ºå±‚æ¬¡ç»“æ„"""
    indent = "  " * level
    
    if isinstance(data, dict):
        for key, value in data.items():
            if key == 'children' and isinstance(value, list):
                for i, child in enumerate(value):
                    print(f"{indent}â”œâ”€ å­ä»»åŠ¡ {i+1}")
                    display_hierarchy(child, level + 1)
            elif key in ['node_id', 'graph_name', 'status', 'output']:
                if key == 'output' and len(str(value)) > 100:
                    value = str(value)[:100] + "..."
                print(f"{indent}{key}: {value}")

display_hierarchy(hierarchy)

# åˆ†æå±‚æ¬¡ç»“æ„
def analyze_hierarchy(hierarchy):
    """åˆ†æä¼šè¯çš„å±‚æ¬¡ç»“æ„"""
    def count_levels(data, current_level=0):
        max_level = current_level
        if isinstance(data, dict) and 'children' in data:
            for child in data['children']:
                max_level = max(max_level, count_levels(child, current_level + 1))
        return max_level
    
    def count_nodes(data):
        count = 1  # å½“å‰èŠ‚ç‚¹
        if isinstance(data, dict) and 'children' in data:
            for child in data['children']:
                count += count_nodes(child)
        return count
    
    max_depth = count_levels(hierarchy)
    total_nodes = count_nodes(hierarchy)
    
    print(f"\nğŸ“Š å±‚æ¬¡ç»“æ„åˆ†æ:")
    print(f"   æœ€å¤§æ·±åº¦: {max_depth} å±‚")
    print(f"   æ€»èŠ‚ç‚¹æ•°: {total_nodes} ä¸ª")
    
    return {"max_depth": max_depth, "total_nodes": total_nodes}

# æ‰§è¡Œåˆ†æ
stats = analyze_hierarchy(hierarchy)
</code></pre>
                    </div>

                    <h3>å¯è§†åŒ–å±‚æ¬¡ç»“æ„</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">def visualize_conversation_tree(conv_id):
    """å¯è§†åŒ–ä¼šè¯çš„æ ‘å½¢ç»“æ„"""
    hierarchy = mag.get_conversation_hierarchy(conv_id)
    
    def draw_tree(data, prefix="", is_last=True, level=0):
        if level == 0:
            print(f"ğŸŒ³ ä¼šè¯æ ‘: {conv_id}")
        
        # å†³å®šå½“å‰èŠ‚ç‚¹çš„è¿æ¥ç¬¦
        current_prefix = "â””â”€â”€ " if is_last else "â”œâ”€â”€ "
        
        # æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯
        node_info = ""
        if isinstance(data, dict):
            node_id = data.get('node_id', 'unknown')
            status = data.get('status', 'unknown')
            
            # çŠ¶æ€å›¾æ ‡
            status_icon = {
                'success': 'âœ…',
                'running': 'ğŸ”„', 
                'error': 'âŒ',
                'pending': 'â³'
            }.get(status, 'â“')
            
            node_info = f"{status_icon} {node_id} ({status})"
        
        print(f"{prefix}{current_prefix}{node_info}")
        
        # å¤„ç†å­èŠ‚ç‚¹
        if isinstance(data, dict) and 'children' in data:
            children = data['children']
            for i, child in enumerate(children):
                is_child_last = (i == len(children) - 1)
                child_prefix = prefix + ("    " if is_last else "â”‚   ")
                draw_tree(child, child_prefix, is_child_last, level + 1)
    
    draw_tree(hierarchy)

# å¯è§†åŒ–ä¼šè¯æ ‘
conversations = mag.list_conversations()
if conversations:
    visualize_conversation_tree(conversations[0])
</code></pre>
                    </div>
                </div>
            </section>

            <!-- ä¼šè¯ç®¡ç†æœ€ä½³å®è·µ -->
            <section class="section">
                <h2><i class="fas fa-lightbulb"></i> ä¼šè¯ç®¡ç†æœ€ä½³å®è·µ</h2>

                <h3>ä¼šè¯ç›‘æ§å’Œç»´æŠ¤</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    <pre><code class="language-python">class ConversationManager:
    """ä¼šè¯ç®¡ç†å™¨"""
    
    def __init__(self):
        self.conversations = {}
        self.load_conversations()
    
    def load_conversations(self):
        """åŠ è½½æ‰€æœ‰ä¼šè¯"""
        try:
            conv_ids = mag.list_conversations()
            for conv_id in conv_ids:
                try:
                    conv_data = mag.get_conversation(conv_id)
                    self.conversations[conv_id] = conv_data
                except Exception as e:
                    print(f"è­¦å‘Š: æ— æ³•åŠ è½½ä¼šè¯ {conv_id}: {e}")
        except Exception as e:
            print(f"åŠ è½½ä¼šè¯åˆ—è¡¨å¤±è´¥: {e}")
    
    def get_statistics(self):
        """è·å–ä¼šè¯ç»Ÿè®¡ä¿¡æ¯"""
        total = len(self.conversations)
        if total == 0:
            return {"total": 0}
        
        status_count = {}
        graph_count = {}
        total_attachments = 0
        total_size = 0
        
        for conv_data in self.conversations.values():
            # ç»Ÿè®¡çŠ¶æ€
            status = conv_data.get('status', 'unknown')
            status_count[status] = status_count.get(status, 0) + 1
            
            # ç»Ÿè®¡å›¾åç§°
            graph_name = conv_data.get('graph_name', 'unknown')
            graph_count[graph_name] = graph_count.get(graph_name, 0) + 1
            
            # ç»Ÿè®¡é™„ä»¶
            attachments = conv_data.get('attachments', [])
            total_attachments += len(attachments)
            total_size += sum(att.get('size', 0) for att in attachments)
        
        return {
            "total": total,
            "status_distribution": status_count,
            "graph_distribution": graph_count,
            "total_attachments": total_attachments,
            "total_size": total_size
        }
    
    def print_dashboard(self):
        """æ‰“å°ä¼šè¯ä»ªè¡¨æ¿"""
        stats = self.get_statistics()
        
        print("ğŸ“Š ä¼šè¯ç®¡ç†ä»ªè¡¨æ¿")
        print("=" * 50)
        print(f"æ€»ä¼šè¯æ•°: {stats['total']}")
        
        if stats['total'] > 0:
            print(f"æ€»é™„ä»¶æ•°: {stats['total_attachments']}")
            print(f"æ€»å­˜å‚¨å¤§å°: {stats['total_size']:,} å­—èŠ‚ ({stats['total_size']/1024/1024:.1f} MB)")
            
            print("\nğŸ“ˆ çŠ¶æ€åˆ†å¸ƒ:")
            for status, count in stats['status_distribution'].items():
                percentage = count / stats['total'] * 100
                print(f"   {status}: {count} ({percentage:.1f}%)")
            
            print("\nğŸ“‹ å›¾ä½¿ç”¨åˆ†å¸ƒ:")
            for graph, count in sorted(stats['graph_distribution'].items(), 
                                     key=lambda x: x[1], reverse=True):
                percentage = count / stats['total'] * 100
                print(f"   {graph}: {count} ({percentage:.1f}%)")
    
    def cleanup_failed_conversations(self, confirm=True):
        """æ¸…ç†å¤±è´¥çš„ä¼šè¯"""
        failed_convs = [conv_id for conv_id, conv_data in self.conversations.items()
                       if conv_data.get('status') in ['error', 'failed']]
        
        if not failed_convs:
            print("æ²¡æœ‰æ‰¾åˆ°å¤±è´¥çš„ä¼šè¯")
            return
        
        print(f"å‘ç° {len(failed_convs)} ä¸ªå¤±è´¥çš„ä¼šè¯:")
        for conv_id in failed_convs:
            conv_data = self.conversations[conv_id]
            print(f"  â€¢ {conv_id} - {conv_data.get('graph_name', 'unknown')}")
        
        if confirm:
            confirm_input = input("ç¡®è®¤åˆ é™¤æ‰€æœ‰å¤±è´¥çš„ä¼šè¯? (yes/no): ")
            if confirm_input.lower() != 'yes':
                print("å–æ¶ˆæ¸…ç†æ“ä½œ")
                return
        
        batch_delete_conversations(failed_convs, confirm=False)
        self.load_conversations()  # é‡æ–°åŠ è½½

# ä½¿ç”¨ä¼šè¯ç®¡ç†å™¨
manager = ConversationManager()
manager.print_dashboard()

# æ¸…ç†å¤±è´¥çš„ä¼šè¯
manager.cleanup_failed_conversations()
</code></pre>
                </div>

                <h3>ä¼šè¯å¤‡ä»½å’Œæ¢å¤</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    <pre><code class="language-python">import json
import shutil
from pathlib import Path

def backup_conversations(backup_dir="conversation_backup"):
    """å¤‡ä»½æ‰€æœ‰ä¼šè¯"""
    backup_path = Path(backup_dir)
    backup_path.mkdir(exist_ok=True)
    
    conversations = mag.list_conversations()
    backup_info = {
        "backup_date": datetime.now().isoformat(),
        "total_conversations": len(conversations),
        "conversations": []
    }
    
    print(f"å¼€å§‹å¤‡ä»½ {len(conversations)} ä¸ªä¼šè¯åˆ° {backup_path}")
    
    for conv_id in conversations:
        try:
            # è·å–ä¼šè¯æ•°æ®
            conv_data = mag.get_conversation(conv_id)
            
            # åˆ›å»ºä¼šè¯å¤‡ä»½ç›®å½•
            conv_backup_dir = backup_path / conv_id
            conv_backup_dir.mkdir(exist_ok=True)
            
            # ä¿å­˜ä¼šè¯å…ƒæ•°æ®
            metadata = {
                "conversation_id": conv_id,
                "graph_name": conv_data.get('graph_name'),
                "status": conv_data.get('status'),
                "output": conv_data.get('output')
            }
            
            with open(conv_backup_dir / "metadata.json", 'w', encoding='utf-8') as f:
                json.dump(metadata, f, indent=2, ensure_ascii=False)
            
            # å¤åˆ¶é™„ä»¶
            attachments = conv_data.get('attachments', [])
            if attachments:
                attachments_dir = conv_backup_dir / "attachments"
                attachments_dir.mkdir(exist_ok=True)
                
                for attachment in attachments:
                    source_path = Path(attachment['path'])
                    if source_path.exists():
                        dest_path = attachments_dir / attachment['name']
                        shutil.copy2(source_path, dest_path)
            
            backup_info["conversations"].append({
                "id": conv_id,
                "status": "success",
                "attachments_count": len(attachments)
            })
            
            print(f"âœ… å¤‡ä»½å®Œæˆ: {conv_id}")
            
        except Exception as e:
            print(f"âŒ å¤‡ä»½å¤±è´¥: {conv_id} - {e}")
            backup_info["conversations"].append({
                "id": conv_id,
                "status": "failed",
                "error": str(e)
            })
    
    # ä¿å­˜å¤‡ä»½ä¿¡æ¯
    with open(backup_path / "backup_info.json", 'w', encoding='utf-8') as f:
        json.dump(backup_info, f, indent=2, ensure_ascii=False)
    
    successful = sum(1 for conv in backup_info["conversations"] if conv["status"] == "success")
    print(f"\nå¤‡ä»½å®Œæˆ: {successful}/{len(conversations)} ä¸ªä¼šè¯æˆåŠŸå¤‡ä»½")
    
    return backup_path

# æ‰§è¡Œå¤‡ä»½
backup_path = backup_conversations()
print(f"å¤‡ä»½å·²ä¿å­˜åˆ°: {backup_path}")
</code></pre>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // å¤åˆ¶ä»£ç åŠŸèƒ½
        function copyCode(button) {
            const code = button.nextElementSibling.textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'å·²å¤åˆ¶!';
                button.style.background = '#10b981';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#4b5563';
                }, 2000);
            });
        }

        // å¯¼èˆªé“¾æ¥ç‚¹å‡»å¤„ç†
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // ç§»é™¤å…¶ä»–æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.nav-link.active').forEach(el => {
                    el.classList.remove('active');
                });
                // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°å½“å‰é“¾æ¥
                e.target.classList.add('active');
            });
        });

        // é¡µé¢å†…é”šç‚¹æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(link.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // ä»£ç é«˜äº®
        Prism.highlightAll();
    </script>
</body>
</html>