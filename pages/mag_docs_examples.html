<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤ºä¾‹æ•™ç¨‹ - MAG SDK ä½¿ç”¨æ–‡æ¡£</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 280px;
            background: #fff;
            border-right: 1px solid #e1e5e9;
            padding: 20px 0;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 20px;
        }

        .logo h1 {
            color: #2563eb;
            font-size: 24px;
            font-weight: 700;
        }

        .logo p {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }

        .nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.2s;
            border-right: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: #f3f4f6;
            color: #2563eb;
        }

        .nav-link.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-right-color: #2563eb;
        }

        .nav-link i {
            margin-right: 10px;
            width: 16px;
        }

        /* æŠ˜å èœå•æ ·å¼ */
        .nav-group {
            margin-bottom: 10px;
        }

        .nav-group-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            color: #374151;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-group-title:hover {
            background-color: #f9fafb;
            color: #2563eb;
        }

        .nav-group-title.active {
            background-color: #eff6ff;
            color: #2563eb;
        }

        .nav-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-group-content .nav-link {
            padding-left: 50px;
            font-size: 14px;
        }

        .chevron {
            transition: transform 0.3s ease;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px 60px;
            background: #fff;
            min-height: 100vh;
        }

        /* é¡µé¢å¤´éƒ¨ */
        .page-header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .page-header h1 {
            color: #1f2937;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* å†…å®¹åŒºå— */
        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #1f2937;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #374151;
            font-size: 1.3rem;
            margin: 30px 0 15px;
        }

        .section p {
            color: #6b7280;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* ä»£ç å—æ ·å¼ */
        .code-block {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4b5563;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #6b7280;
        }

        /* ç¤ºä¾‹å¡ç‰‡ */
        .example-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .example-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .example-icon {
            background: #2563eb;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .example-title {
            color: #1f2937;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* æ³¨æ„äº‹é¡¹ */
        .note {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .note h4 {
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note p {
            color: #b45309;
            margin: 0;
        }

        /* æˆåŠŸæç¤º */
        .success {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .success h4 {
            color: #065f46;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .success p {
            color: #047857;
            margin: 0;
        }

        /* ç›®å½•å¯¼èˆª */
        .toc {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc h3 {
            color: #374151;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #2563eb;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .toc a:hover {
            background: #eff6ff;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps {
            display: grid;
            gap: 20px;
            margin: 30px 0;
        }

        .step {
            display: flex;
            align-items: flex-start;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2563eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .step-number {
            background: #2563eb;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: #1f2937;
            margin-bottom: 10px;
        }

        .step-content p {
            margin: 0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .page-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <nav class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-project-diagram"></i> MAG SDK</h1>
                <p>MCP Agent Graph å¼€å‘æ¡†æ¶</p>
            </div>
            
            <ul class="nav">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        æ¦‚è¿°
                    </a>
                </li>
                
                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-cog"></i> ç³»ç»Ÿç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="system.html#system-start" class="nav-link">
                            <i class="fas fa-play"></i>
                            å¯åŠ¨æœåŠ¡
                        </a>
                        <a href="system.html#system-status" class="nav-link">
                            <i class="fas fa-info-circle"></i>
                            çŠ¶æ€æ£€æŸ¥
                        </a>
                        <a href="system.html#system-shutdown" class="nav-link">
                            <i class="fas fa-stop"></i>
                            å…³é—­æœåŠ¡
                        </a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-project-diagram"></i> å›¾ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="graph.html#graph-list" class="nav-link">åˆ—å‡ºå›¾</a>
                        <a href="graph.html#graph-get" class="nav-link">è·å–å›¾</a>
                        <a href="graph.html#graph-save" class="nav-link">ä¿å­˜å›¾</a>
                        <a href="graph.html#graph-delete" class="nav-link">åˆ é™¤å›¾</a>
                        <a href="graph.html#graph-run" class="nav-link">è¿è¡Œå›¾</a>
                        <a href="graph.html#graph-import" class="nav-link">å¯¼å…¥å›¾</a>
                        <a href="graph.html#graph-export" class="nav-link">å¯¼å‡ºå›¾</a>
                        <a href="graph.html#graph-mcp" class="nav-link">ç”ŸæˆMCPè„šæœ¬</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-brain"></i> æ¨¡å‹ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="model.html#model-list" class="nav-link">åˆ—å‡ºæ¨¡å‹</a>
                        <a href="model.html#model-add" class="nav-link">æ·»åŠ æ¨¡å‹</a>
                        <a href="model.html#model-update" class="nav-link">æ›´æ–°æ¨¡å‹</a>
                        <a href="model.html#model-delete" class="nav-link">åˆ é™¤æ¨¡å‹</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-server"></i> MCPç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="mcp.html#mcp-config" class="nav-link">é…ç½®ç®¡ç†</a>
                        <a href="mcp.html#mcp-status" class="nav-link">çŠ¶æ€æŸ¥çœ‹</a>
                        <a href="mcp.html#mcp-connect" class="nav-link">è¿æ¥æœåŠ¡å™¨</a>
                        <a href="mcp.html#mcp-tools" class="nav-link">å·¥å…·ç®¡ç†</a>
                        <a href="mcp.html#mcp-servers" class="nav-link">æœåŠ¡å™¨ç®¡ç†</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-comments"></i> ä¼šè¯ç®¡ç†</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="conversation.html#conversation-list" class="nav-link">åˆ—å‡ºä¼šè¯</a>
                        <a href="conversation.html#conversation-get" class="nav-link">è·å–ä¼šè¯</a>
                        <a href="conversation.html#conversation-delete" class="nav-link">åˆ é™¤ä¼šè¯</a>
                    </div>
                </li>

                <li class="nav-item">
                    <a href="#examples" class="nav-link active">
                        <i class="fas fa-code"></i>
                        ç¤ºä¾‹æ•™ç¨‹
                    </a>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="page-header">
                <h1><i class="fas fa-code"></i> ç¤ºä¾‹æ•™ç¨‹</h1>
                <p>å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ã€æœ€ä½³å®è·µå’Œåº”ç”¨åœºæ™¯æŒ‡å—</p>
            </div>

            <!-- ç›®å½•å¯¼èˆª -->
            <div class="toc">
                <h3><i class="fas fa-list"></i> æœ¬é¡µå†…å®¹</h3>
                <ul>
                    <li><a href="#quick-start">å¿«é€Ÿå…¥é—¨</a></li>
                    <li><a href="#complete-workflow">å®Œæ•´å·¥ä½œæµç¤ºä¾‹</a></li>
                    <li><a href="#use-cases">å¸¸è§ä½¿ç”¨åœºæ™¯</a></li>
                    <li><a href="#best-practices">æœ€ä½³å®è·µ</a></li>
                    <li><a href="#troubleshooting">æ•…éšœæ’é™¤</a></li>
                    <li><a href="#advanced-usage">é«˜çº§ç”¨æ³•</a></li>
                </ul>
            </div>

            <!-- å¿«é€Ÿå…¥é—¨ -->
            <section class="section" id="quick-start">
                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="example-title">å¿«é€Ÿå…¥é—¨ç¤ºä¾‹</div>
                    </div>
                    
                    <p>è¿™ä¸ªç¤ºä¾‹å°†å¸¦æ‚¨å¿«é€Ÿä½“éªŒMAG SDKçš„æ ¸å¿ƒåŠŸèƒ½ï¼šä»å¯åŠ¨æœåŠ¡åˆ°è¿è¡Œæ‚¨çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½ä½“å›¾ã€‚</p>

                    <div class="steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>å®‰è£…å’Œå¯åŠ¨</h4>
                                <p>å®‰è£…MAG SDKå¹¶å¯åŠ¨æœåŠ¡</p>
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># å®‰è£…MAG SDK
# pip install mcp-agent-graph

import mag

# å¯åŠ¨MAGæœåŠ¡
print("æ­£åœ¨å¯åŠ¨MAGæœåŠ¡...")
if mag.start():
    print("âœ… MAGæœåŠ¡å¯åŠ¨æˆåŠŸï¼")
else:
    print("âŒ æœåŠ¡å¯åŠ¨å¤±è´¥")
    exit(1)

# éªŒè¯æœåŠ¡çŠ¶æ€
if mag.is_running():
    print("âœ… æœåŠ¡è¿è¡Œæ­£å¸¸")
else:
    print("âŒ æœåŠ¡æœªæ­£å¸¸è¿è¡Œ")
</code></pre>
                    </div>

                    <div class="steps">
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>é…ç½®æ¨¡å‹</h4>
                                <p>æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªAIæ¨¡å‹</p>
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ·»åŠ AIæ¨¡å‹é…ç½®
model_config = {
    "name": "gpt-4",
    "base_url": "https://api.openai.com/v1/",
    "api_key": "your-openai-api-key-here",  # è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…APIå¯†é’¥
    "model": "gpt-4"
}

result = mag.add_model(model_config)
if result.get("status") == "success":
    print("âœ… æ¨¡å‹æ·»åŠ æˆåŠŸ")
else:
    print(f"âŒ æ¨¡å‹æ·»åŠ å¤±è´¥: {result.get('message')}")

# éªŒè¯æ¨¡å‹åˆ—è¡¨
models = mag.list_models()
print(f"å½“å‰é…ç½®çš„æ¨¡å‹: {[m['name'] for m in models]}")
</code></pre>
                    </div>

                    <div class="steps">
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>åˆ›å»ºç®€å•å›¾</h4>
                                <p>åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½ä½“å›¾</p>
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># åˆ›å»ºä¸€ä¸ªç®€å•çš„èŠå¤©å›¾
simple_graph = {
    "name": "hello_world",
    "description": "æˆ‘çš„ç¬¬ä¸€ä¸ªMAGå›¾",
    "nodes": [
        {
            "id": "chat_node",
            "name": "èŠå¤©åŠ©æ‰‹",
            "type": "agent",
            "model_name": "gpt-4",
            "system_prompt": "ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ï¼Œè¯·ç”¨ç®€æ´æ˜äº†çš„æ–¹å¼å›ç­”é—®é¢˜ã€‚",
            "user_prompt": "ç”¨æˆ·é—®é¢˜ï¼š{input}\\n\\nè¯·æä¾›æœ‰å¸®åŠ©çš„å›ç­”ã€‚",
            "mcp_servers": [],
            "position": {"x": 100, "y": 100}
        }
    ],
    "edges": [],
    "version": "1.0"
}

# ä¿å­˜å›¾
result = mag.save_graph(simple_graph)
if result.get("status") == "success":
    print("âœ… å›¾åˆ›å»ºæˆåŠŸ")
    
    # æŸ¥çœ‹å›¾åˆ—è¡¨
    graphs = mag.list_graphs()
    print(f"å½“å‰å›¾åˆ—è¡¨: {graphs}")
else:
    print(f"âŒ å›¾åˆ›å»ºå¤±è´¥: {result.get('message')}")
</code></pre>
                    </div>

                    <div class="steps">
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>è¿è¡Œå›¾</h4>
                                <p>æ‰§è¡Œæ‚¨çš„æ™ºèƒ½ä½“å›¾</p>
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># è¿è¡Œå›¾
print("æ­£åœ¨è¿è¡Œå›¾...")
result = mag.run_graph(
    name="hello_world",
    input_text="ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹MAGæ¡†æ¶çš„ä¸»è¦åŠŸèƒ½ã€‚",
    parallel=False
)

# å¤„ç†ç»“æœ
if result.get("status") == "success":
    print("âœ… å›¾æ‰§è¡ŒæˆåŠŸ")
    print(f"ä¼šè¯ID: {result['conversation_id']}")
    print(f"è¾“å‡ºç»“æœï¼š")
    print("-" * 50)
    print(result.get("output", ""))
    print("-" * 50)
else:
    print(f"âŒ å›¾æ‰§è¡Œå¤±è´¥: {result.get('error', 'Unknown error')}")

# æ¸…ç†ï¼ˆå¯é€‰ï¼‰
print("\\næ­£åœ¨å…³é—­æœåŠ¡...")
mag.shutdown()
print("âœ… æœåŠ¡å·²å…³é—­")
</code></pre>
                    </div>

                    <div class="success">
                        <h4><i class="fas fa-check-circle"></i> æ­å–œï¼</h4>
                        <p>æ‚¨å·²ç»æˆåŠŸè¿è¡Œäº†ç¬¬ä¸€ä¸ªMAGæ™ºèƒ½ä½“å›¾ï¼æ¥ä¸‹æ¥å¯ä»¥æ¢ç´¢æ›´å¤æ‚çš„åŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
                    </div>
                </div>
            </section>

            <!-- å®Œæ•´å·¥ä½œæµç¤ºä¾‹ -->
            <section class="section" id="complete-workflow">
                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="example-title">å®Œæ•´å·¥ä½œæµç¤ºä¾‹</div>
                    </div>
                    
                    <p>è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåŒ…å«æœç´¢ã€åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆçš„å®Œæ•´ç ”ç©¶å·¥ä½œæµã€‚</p>

                    <h3>åœºæ™¯æè¿°</h3>
                    <p>åˆ›å»ºä¸€ä¸ªç ”ç©¶åŠ©æ‰‹å›¾ï¼Œèƒ½å¤Ÿï¼š</p>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li>ä½¿ç”¨Tavilyæœç´¢å¼•æ“æœç´¢ç›¸å…³ä¿¡æ¯</li>
                        <li>åˆ†ææœç´¢ç»“æœå¹¶æå–å…³é”®ä¿¡æ¯</li>
                        <li>ç”Ÿæˆç»“æ„åŒ–çš„ç ”ç©¶æŠ¥å‘Š</li>
                    </ul>

                    <h3>æ­¥éª¤1ï¼šè®¾ç½®ç¯å¢ƒ</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag
import json
import time
from datetime import datetime

# å¯åŠ¨æœåŠ¡
print("å¯åŠ¨MAGæœåŠ¡...")
if not mag.start():
    print("âŒ æœåŠ¡å¯åŠ¨å¤±è´¥")
    exit(1)

print("âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ")
</code></pre>
                    </div>

                    <h3>æ­¥éª¤2ï¼šé…ç½®æ¨¡å‹å’ŒMCPæœåŠ¡å™¨</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># é…ç½®AIæ¨¡å‹
models_to_add = [
    {
        "name": "gpt-4",
        "base_url": "https://api.openai.com/v1/",
        "api_key": "your-openai-api-key",
        "model": "gpt-4"
    },
    {
        "name": "gpt-3.5-turbo", 
        "base_url": "https://api.openai.com/v1/",
        "api_key": "your-openai-api-key",
        "model": "gpt-3.5-turbo"
    }
]

for model in models_to_add:
    try:
        result = mag.add_model(model)
        print(f"âœ… æ¨¡å‹ {model['name']} æ·»åŠ æˆåŠŸ")
    except Exception as e:
        print(f"âš ï¸  æ¨¡å‹ {model['name']} å¯èƒ½å·²å­˜åœ¨: {e}")

# é…ç½®MCPæœåŠ¡å™¨
mcp_config = {
    "mcpServers": {
        "tavily-mcp": {
            "command": "npx",
            "args": ["-y", "tavily-mcp@0.1.2"],
            "env": {
                "TAVILY_API_KEY": "your-tavily-api-key"  # è¯·æ›¿æ¢ä¸ºå®é™…APIå¯†é’¥
            }
        },
        "fetch": {
            "autoApprove": ["fetch"],
            "timeout": 60,
            "command": "uvx",
            "args": ["mcp-server-fetch"],
            "transportType": "stdio"
        }
    }
}

# æ›´æ–°MCPé…ç½®
result = mag.update_mcp_config(mcp_config)
print("âœ… MCPé…ç½®æ›´æ–°å®Œæˆ")

# è¿æ¥æ‰€æœ‰MCPæœåŠ¡å™¨
print("è¿æ¥MCPæœåŠ¡å™¨...")
result = mag.connect_mcp("all")
print(f"è¿æ¥ç»“æœ: {result.get('status', 'unknown')}")
</code></pre>
                    </div>

                    <h3>æ­¥éª¤3ï¼šåˆ›å»ºç ”ç©¶å·¥ä½œæµå›¾</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># åˆ›å»ºç ”ç©¶å·¥ä½œæµå›¾
research_graph = {
    "name": "research_workflow",
    "description": "å®Œæ•´çš„ç ”ç©¶å·¥ä½œæµï¼šæœç´¢ -> åˆ†æ -> æŠ¥å‘Š",
    "nodes": [
        {
            "id": "search_node",
            "name": "ä¿¡æ¯æœç´¢",
            "type": "agent",
            "model_name": "gpt-3.5-turbo",
            "system_prompt": """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¿¡æ¯æœç´¢ä¸“å®¶ã€‚
ä»»åŠ¡ï¼šæ ¹æ®ç”¨æˆ·çš„ç ”ç©¶ä¸»é¢˜ï¼Œä½¿ç”¨æœç´¢å·¥å…·æ”¶é›†ç›¸å…³ä¿¡æ¯ã€‚
è¦æ±‚ï¼š
1. ç†è§£ç”¨æˆ·çš„ç ”ç©¶éœ€æ±‚
2. è®¾è®¡æœ‰æ•ˆçš„æœç´¢å…³é”®è¯
3. æ”¶é›†å¤šä¸ªè§’åº¦çš„ä¿¡æ¯
4. æ•´ç†æœç´¢ç»“æœ""",
            "user_prompt": "ç ”ç©¶ä¸»é¢˜ï¼š{input}\\n\\nè¯·æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå¹¶æ•´ç†æœç´¢ç»“æœã€‚",
            "mcp_servers": ["tavily-mcp"],
            "position": {"x": 100, "y": 100}
        },
        {
            "id": "analysis_node",
            "name": "ä¿¡æ¯åˆ†æ",
            "type": "agent", 
            "model_name": "gpt-4",
            "system_prompt": """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆã€‚
ä»»åŠ¡ï¼šåˆ†æå‰ä¸€æ­¥æœç´¢åˆ°çš„ä¿¡æ¯ï¼Œæå–å…³é”®æ´å¯Ÿã€‚
è¦æ±‚ï¼š
1. æ·±å…¥åˆ†ææœç´¢ç»“æœ
2. è¯†åˆ«é‡è¦è¶‹åŠ¿å’Œæ¨¡å¼
3. æå–å…³é”®æ•°æ®å’Œäº‹å®
4. è¯„ä¼°ä¿¡æ¯çš„å¯é æ€§
5. æ€»ç»“ä¸»è¦å‘ç°""",
            "user_prompt": "åŸºäºä»¥ä¸‹æœç´¢ç»“æœè¿›è¡Œæ·±åº¦åˆ†æï¼š\\n\\n{previous_output}\\n\\nè¯·æä¾›è¯¦ç»†çš„åˆ†ææŠ¥å‘Šã€‚",
            "mcp_servers": [],
            "position": {"x": 300, "y": 100}
        },
        {
            "id": "report_node",
            "name": "æŠ¥å‘Šç”Ÿæˆ",
            "type": "agent",
            "model_name": "gpt-4",
            "system_prompt": """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯å†™ä½œä¸“å®¶ã€‚
ä»»åŠ¡ï¼šåŸºäºåˆ†æç»“æœç”Ÿæˆç»“æ„åŒ–çš„ç ”ç©¶æŠ¥å‘Šã€‚
è¦æ±‚ï¼š
1. åˆ›å»ºæ¸…æ™°çš„æŠ¥å‘Šç»“æ„
2. ä½¿ç”¨ä¸“ä¸šçš„å†™ä½œé£æ ¼
3. åŒ…å«æ‰§è¡Œæ‘˜è¦
4. æä¾›è¯¦ç»†çš„åˆ†æå†…å®¹
5. ç»™å‡ºç»“è®ºå’Œå»ºè®®
6. ä½¿ç”¨Markdownæ ¼å¼""",
            "user_prompt": "åŸºäºä»¥ä¸‹åˆ†æç»“æœç”Ÿæˆä¸“ä¸šç ”ç©¶æŠ¥å‘Šï¼š\\n\\n{previous_output}\\n\\nè¯·ç”Ÿæˆç»“æ„åŒ–çš„MarkdownæŠ¥å‘Šã€‚",
            "mcp_servers": [],
            "position": {"x": 500, "y": 100}
        }
    ],
    "edges": [
        {"from": "search_node", "to": "analysis_node"},
        {"from": "analysis_node", "to": "report_node"}
    ],
    "version": "1.0"
}

# ä¿å­˜å›¾
result = mag.save_graph(research_graph)
if result.get("status") == "success":
    print("âœ… ç ”ç©¶å·¥ä½œæµå›¾åˆ›å»ºæˆåŠŸ")
else:
    print(f"âŒ å›¾åˆ›å»ºå¤±è´¥: {result.get('message')}")
</code></pre>
                    </div>

                    <h3>æ­¥éª¤4ï¼šæ‰§è¡Œç ”ç©¶å·¥ä½œæµ</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ‰§è¡Œç ”ç©¶å·¥ä½œæµ
research_topic = "å¤§è¯­è¨€æ¨¡å‹åœ¨2024å¹´çš„æœ€æ–°å‘å±•è¶‹åŠ¿"

print(f"å¼€å§‹ç ”ç©¶ï¼š{research_topic}")
print("=" * 60)

start_time = time.time()

# è¿è¡Œå›¾
result = mag.run_graph(
    name="research_workflow",
    input_text=research_topic,
    parallel=False  # é¡ºåºæ‰§è¡Œç¡®ä¿æ•°æ®æµæ­£ç¡®
)

execution_time = time.time() - start_time

# å¤„ç†ç»“æœ
if result.get("status") == "success":
    print("âœ… ç ”ç©¶å·¥ä½œæµæ‰§è¡ŒæˆåŠŸ")
    print(f"â±ï¸  æ‰§è¡Œæ—¶é—´: {execution_time:.1f} ç§’")
    print(f"ğŸ“‹ ä¼šè¯ID: {result['conversation_id']}")
    
    # æ˜¾ç¤ºæœ€ç»ˆæŠ¥å‘Š
    print("\\nğŸ“„ ç ”ç©¶æŠ¥å‘Š:")
    print("=" * 60)
    print(result.get("output", ""))
    
    # è·å–è¯¦ç»†çš„ä¼šè¯ä¿¡æ¯
    conversation = mag.get_conversation(result['conversation_id'])
    
    # æ£€æŸ¥æ˜¯å¦æœ‰é™„ä»¶
    attachments = conversation.get('attachments', [])
    if attachments:
        print(f"\\nğŸ“ ç”Ÿæˆçš„é™„ä»¶ ({len(attachments)} ä¸ª):")
        for att in attachments:
            print(f"   â€¢ {att['name']} ({att['type']}) - {att.get('size', 0)} å­—èŠ‚")
    
    # æ˜¾ç¤ºå„èŠ‚ç‚¹çš„æ‰§è¡Œç»“æœ
    if 'node_results' in conversation:
        print("\\nğŸ”§ å„èŠ‚ç‚¹æ‰§è¡Œæ‘˜è¦:")
        for node_id, node_result in conversation['node_results'].items():
            status = node_result.get('status', 'unknown')
            status_icon = 'âœ…' if status == 'success' else 'âŒ'
            print(f"   {status_icon} {node_id}: {status}")
            
            if node_result.get('output'):
                output_preview = node_result['output'][:100] + "..." if len(node_result['output']) > 100 else node_result['output']
                print(f"      é¢„è§ˆ: {output_preview}")

else:
    print(f"âŒ ç ”ç©¶å·¥ä½œæµæ‰§è¡Œå¤±è´¥")
    print(f"é”™è¯¯ä¿¡æ¯: {result.get('error', 'Unknown error')}")
</code></pre>
                    </div>

                    <h3>æ­¥éª¤5ï¼šç»“æœåˆ†æå’Œåç»­å¤„ç†</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># åˆ†æå’Œåç»­å¤„ç†
def analyze_research_results(conversation_id):
    """åˆ†æç ”ç©¶ç»“æœ"""
    conversation = mag.get_conversation(conversation_id)
    
    print("\\nğŸ“Š ç ”ç©¶ç»“æœåˆ†æ:")
    print("-" * 40)
    
    # åŸºæœ¬ç»Ÿè®¡
    output = conversation.get('output', '')
    word_count = len(output.split())
    char_count = len(output)
    
    print(f"æŠ¥å‘Šå­—æ•°: {word_count:,}")
    print(f"å­—ç¬¦æ•°: {char_count:,}")
    
    # èŠ‚ç‚¹æ‰§è¡Œåˆ†æ
    node_results = conversation.get('node_results', {})
    for node_id, result in node_results.items():
        output_length = len(result.get('output', ''))
        print(f"{node_id} è¾“å‡ºé•¿åº¦: {output_length:,} å­—ç¬¦")
    
    # ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"research_report_{timestamp}.md"
    
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(f"# ç ”ç©¶æŠ¥å‘Š\\n\\n")
        f.write(f"**ç”Ÿæˆæ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\\n")
        f.write(f"**ä¼šè¯ID**: {conversation_id}\\n\\n")
        f.write(output)
    
    print(f"\\nğŸ’¾ æŠ¥å‘Šå·²ä¿å­˜ä¸º: {filename}")
    return filename

# å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ†æç»“æœ
if result.get("status") == "success":
    report_file = analyze_research_results(result['conversation_id'])
    
    # å¯é€‰ï¼šå¯¼å‡ºå›¾é…ç½®ä»¥ä¾¿å¤ç”¨
    export_result = mag.export_graph("research_workflow")
    if export_result.get("status") == "success":
        print(f"ğŸ“¦ å›¾é…ç½®å·²å¯¼å‡ºä¸º: {export_result['file_path']}")

print("\\nğŸ‰ å®Œæ•´ç ”ç©¶å·¥ä½œæµæ¼”ç¤ºå®Œæˆï¼")
</code></pre>
                    </div>
                </div>
            </section>

            <!-- å¸¸è§ä½¿ç”¨åœºæ™¯ -->
            <section class="section" id="use-cases">
                <h2><i class="fas fa-lightbulb"></i> å¸¸è§ä½¿ç”¨åœºæ™¯</h2>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="example-title">æ™ºèƒ½æœç´¢å’Œä¿¡æ¯æ”¶é›†</div>
                    </div>
                    
                    <p>åˆ›å»ºæ™ºèƒ½æœç´¢åŠ©æ‰‹ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·æ„å›¾ï¼Œæ‰§è¡Œå¤šæºæœç´¢ï¼Œå¹¶æ•´åˆç»“æœã€‚</p>
                    
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ™ºèƒ½æœç´¢å›¾ç¤ºä¾‹
smart_search_graph = {
    "name": "smart_search",
    "description": "æ™ºèƒ½æœç´¢å’Œä¿¡æ¯æ•´åˆ",
    "nodes": [
        {
            "id": "intent_analyzer",
            "name": "æ„å›¾åˆ†æ",
            "model_name": "gpt-4",
            "system_prompt": "åˆ†æç”¨æˆ·æœç´¢æ„å›¾ï¼Œç”Ÿæˆæœ€ä½³æœç´¢ç­–ç•¥",
            "user_prompt": "ç”¨æˆ·æŸ¥è¯¢: {input}\\nè¯·åˆ†ææœç´¢æ„å›¾å¹¶ç”Ÿæˆæœç´¢å…³é”®è¯ã€‚",
            "mcp_servers": []
        },
        {
            "id": "multi_search",
            "name": "å¤šæºæœç´¢", 
            "model_name": "gpt-3.5-turbo",
            "system_prompt": "æ‰§è¡Œå¤šä¸ªæœç´¢æŸ¥è¯¢ï¼Œæ”¶é›†å…¨é¢ä¿¡æ¯",
            "user_prompt": "åŸºäºæœç´¢ç­–ç•¥æ‰§è¡Œæœç´¢: {previous_output}",
            "mcp_servers": ["tavily-mcp", "fetch"]
        },
        {
            "id": "result_synthesizer",
            "name": "ç»“æœæ•´åˆ",
            "model_name": "gpt-4",
            "system_prompt": "æ•´åˆå¤šä¸ªæœç´¢ç»“æœï¼Œæä¾›ç»¼åˆç­”æ¡ˆ",
            "user_prompt": "æ•´åˆä»¥ä¸‹æœç´¢ç»“æœ: {previous_output}",
            "mcp_servers": []
        }
    ],
    "edges": [
        {"from": "intent_analyzer", "to": "multi_search"},
        {"from": "multi_search", "to": "result_synthesizer"}
    ]
}

# ä¿å­˜å¹¶æµ‹è¯•
mag.save_graph(smart_search_graph)
result = mag.run_graph("smart_search", "æœ€æ–°çš„AIèŠ¯ç‰‡æŠ€æœ¯å‘å±•")
</code></pre>
                    </div>
                </div>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="example-title">æ•°æ®åˆ†æå’Œå¯è§†åŒ–</div>
                    </div>
                    
                    <p>æ„å»ºæ•°æ®åˆ†ææµæ°´çº¿ï¼Œä»æ•°æ®æ”¶é›†åˆ°æ¸…ç†ã€åˆ†æå’Œå¯è§†åŒ–ã€‚</p>
                    
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ•°æ®åˆ†ææµæ°´çº¿
data_analysis_graph = {
    "name": "data_analysis_pipeline",
    "description": "æ•°æ®æ”¶é›†ã€æ¸…ç†ã€åˆ†æå’Œå¯è§†åŒ–",
    "nodes": [
        {
            "id": "data_collector",
            "name": "æ•°æ®æ”¶é›†",
            "model_name": "gpt-3.5-turbo",
            "system_prompt": "æ”¶é›†æŒ‡å®šä¸»é¢˜çš„æ•°æ®",
            "user_prompt": "æ”¶é›†å…³äº {input} çš„æ•°æ®",
            "mcp_servers": ["fetch", "tavily-mcp"]
        },
        {
            "id": "data_cleaner", 
            "name": "æ•°æ®æ¸…ç†",
            "model_name": "gpt-4",
            "system_prompt": "æ¸…ç†å’Œæ ‡å‡†åŒ–æ•°æ®æ ¼å¼",
            "user_prompt": "æ¸…ç†ä»¥ä¸‹æ•°æ®: {previous_output}",
            "mcp_servers": []
        },
        {
            "id": "data_analyzer",
            "name": "æ•°æ®åˆ†æ",
            "model_name": "gpt-4",
            "system_prompt": "æ‰§è¡Œç»Ÿè®¡åˆ†æå’Œè¶‹åŠ¿è¯†åˆ«",
            "user_prompt": "åˆ†ææ•°æ®å¹¶è¯†åˆ«æ¨¡å¼: {previous_output}",
            "mcp_servers": []
        },
        {
            "id": "report_generator",
            "name": "æŠ¥å‘Šç”Ÿæˆ",
            "model_name": "gpt-4", 
            "system_prompt": "ç”ŸæˆåŒ…å«å›¾è¡¨çš„åˆ†ææŠ¥å‘Š",
            "user_prompt": "ç”Ÿæˆåˆ†ææŠ¥å‘Š: {previous_output}",
            "mcp_servers": []
        }
    ],
    "edges": [
        {"from": "data_collector", "to": "data_cleaner"},
        {"from": "data_cleaner", "to": "data_analyzer"},
        {"from": "data_analyzer", "to": "report_generator"}
    ]
}
</code></pre>
                    </div>
                </div>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="example-title">å†…å®¹åˆ›ä½œåŠ©æ‰‹</div>
                    </div>
                    
                    <p>åˆ›å»ºå¤šæ­¥éª¤å†…å®¹åˆ›ä½œæµç¨‹ï¼ŒåŒ…æ‹¬ç ”ç©¶ã€å¤§çº²ã€å†™ä½œå’Œæ ¡å¯¹ã€‚</p>
                    
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># å†…å®¹åˆ›ä½œåŠ©æ‰‹
content_creation_graph = {
    "name": "content_creator",
    "description": "å®Œæ•´çš„å†…å®¹åˆ›ä½œæµç¨‹",
    "nodes": [
        {
            "id": "topic_researcher",
            "name": "ä¸»é¢˜ç ”ç©¶",
            "model_name": "gpt-4",
            "system_prompt": "æ·±å…¥ç ”ç©¶å†…å®¹ä¸»é¢˜ï¼Œæ”¶é›†ç›¸å…³ä¿¡æ¯",
            "user_prompt": "ç ”ç©¶ä¸»é¢˜: {input}",
            "mcp_servers": ["tavily-mcp"]
        },
        {
            "id": "outline_creator",
            "name": "å¤§çº²åˆ¶ä½œ",
            "model_name": "gpt-4",
            "system_prompt": "åŸºäºç ”ç©¶ç»“æœåˆ›å»ºè¯¦ç»†å¤§çº²",
            "user_prompt": "åŸºäºç ”ç©¶åˆ›å»ºå¤§çº²: {previous_output}",
            "mcp_servers": []
        },
        {
            "id": "content_writer",
            "name": "å†…å®¹å†™ä½œ",
            "model_name": "gpt-4",
            "system_prompt": "æ ¹æ®å¤§çº²æ’°å†™é«˜è´¨é‡å†…å®¹",
            "user_prompt": "æŒ‰ç…§å¤§çº²æ’°å†™å†…å®¹: {previous_output}",
            "mcp_servers": []
        },
        {
            "id": "content_editor",
            "name": "å†…å®¹ç¼–è¾‘",
            "model_name": "gpt-4",
            "system_prompt": "æ ¡å¯¹å’Œä¼˜åŒ–å†…å®¹è´¨é‡",
            "user_prompt": "ç¼–è¾‘å’Œä¼˜åŒ–å†…å®¹: {previous_output}",
            "mcp_servers": []
        }
    ],
    "edges": [
        {"from": "topic_researcher", "to": "outline_creator"},
        {"from": "outline_creator", "to": "content_writer"},
        {"from": "content_writer", "to": "content_editor"}
    ]
}

# ä½¿ç”¨ç¤ºä¾‹
mag.save_graph(content_creation_graph)
result = mag.run_graph("content_creator", "å¦‚ä½•ä½¿ç”¨AIæé«˜å·¥ä½œæ•ˆç‡")
</code></pre>
                    </div>
                </div>
            </section>

            <!-- æœ€ä½³å®è·µ -->
            <section class="section" id="best-practices">
                <h2><i class="fas fa-star"></i> æœ€ä½³å®è·µ</h2>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="example-title">å®‰å…¨å’Œé”™è¯¯å¤„ç†</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python">import mag
import os
import logging
from contextlib import contextmanager

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@contextmanager
def mag_session():
    """å®‰å…¨çš„MAGä¼šè¯ç®¡ç†å™¨"""
    try:
        # å¯åŠ¨æœåŠ¡
        if not mag.start():
            raise RuntimeError("æ— æ³•å¯åŠ¨MAGæœåŠ¡")
        logger.info("MAGæœåŠ¡å·²å¯åŠ¨")
        yield
    except Exception as e:
        logger.error(f"MAGä¼šè¯å‡ºé”™: {e}")
        raise
    finally:
        # ç¡®ä¿æ¸…ç†
        mag.shutdown()
        logger.info("MAGæœåŠ¡å·²å…³é—­")

def safe_add_model_from_env(model_name, env_prefix):
    """ä»ç¯å¢ƒå˜é‡å®‰å…¨æ·»åŠ æ¨¡å‹"""
    api_key = os.getenv(f"{env_prefix}_API_KEY")
    base_url = os.getenv(f"{env_prefix}_BASE_URL")
    model_id = os.getenv(f"{env_prefix}_MODEL", model_name)
    
    if not api_key:
        raise ValueError(f"ç¯å¢ƒå˜é‡ {env_prefix}_API_KEY æœªè®¾ç½®")
    if not base_url:
        raise ValueError(f"ç¯å¢ƒå˜é‡ {env_prefix}_BASE_URL æœªè®¾ç½®")
    
    model_config = {
        "name": model_name,
        "base_url": base_url,
        "api_key": api_key,
        "model": model_id
    }
    
    try:
        result = mag.add_model(model_config)
        if result.get("status") == "success":
            logger.info(f"æ¨¡å‹ {model_name} æ·»åŠ æˆåŠŸ")
            return True
        else:
            logger.error(f"æ¨¡å‹æ·»åŠ å¤±è´¥: {result.get('message')}")
            return False
    except Exception as e:
        logger.error(f"æ·»åŠ æ¨¡å‹æ—¶å‡ºé”™: {e}")
        return False

def robust_graph_execution(graph_name, input_text, max_retries=3):
    """å¥å£®çš„å›¾æ‰§è¡Œå‡½æ•°"""
    for attempt in range(max_retries):
        try:
            logger.info(f"æ‰§è¡Œå›¾ {graph_name} (å°è¯• {attempt + 1}/{max_retries})")
            result = mag.run_graph(graph_name, input_text)
            
            if result.get("status") == "success":
                logger.info("å›¾æ‰§è¡ŒæˆåŠŸ")
                return result
            else:
                error_msg = result.get("error", "Unknown error")
                logger.warning(f"å›¾æ‰§è¡Œå¤±è´¥: {error_msg}")
                
                if attempt < max_retries - 1:
                    logger.info("å‡†å¤‡é‡è¯•...")
                    time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
                
        except Exception as e:
            logger.error(f"æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™: {e}")
            if attempt < max_retries - 1:
                time.sleep(2 ** attempt)
            else:
                raise
    
    raise RuntimeError(f"å›¾æ‰§è¡Œå¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° {max_retries}")

# ä½¿ç”¨ç¤ºä¾‹
with mag_session():
    # å®‰å…¨åœ°æ·»åŠ æ¨¡å‹
    safe_add_model_from_env("gpt-4", "OPENAI")
    
    # å¥å£®åœ°æ‰§è¡Œå›¾
    result = robust_graph_execution("my_graph", "test input")
</code></pre>
                    </div>
                </div>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="example-title">æ€§èƒ½ä¼˜åŒ–</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

def optimize_graph_for_performance(graph_config):
    """ä¼˜åŒ–å›¾é…ç½®ä»¥æé«˜æ€§èƒ½"""
    optimized = graph_config.copy()
    
    # 1. è¯†åˆ«å¯å¹¶è¡Œæ‰§è¡Œçš„èŠ‚ç‚¹
    parallel_candidates = []
    for node in optimized["nodes"]:
        # æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰å…¥è¾¹
        has_dependencies = any(
            edge["to"] == node["id"] 
            for edge in optimized.get("edges", [])
        )
        if not has_dependencies:
            parallel_candidates.append(node["id"])
    
    print(f"å¯å¹¶è¡Œæ‰§è¡Œçš„èŠ‚ç‚¹: {parallel_candidates}")
    
    # 2. é€‰æ‹©åˆé€‚çš„æ¨¡å‹
    for node in optimized["nodes"]:
        # å¯¹äºç®€å•ä»»åŠ¡ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹
        if "ç®€å•" in node.get("system_prompt", "").lower():
            if node["model_name"] == "gpt-4":
                node["model_name"] = "gpt-3.5-turbo"
                print(f"èŠ‚ç‚¹ {node['id']} é™çº§ä¸ºgpt-3.5-turbo")
    
    # 3. ä¼˜åŒ–æç¤ºè¯é•¿åº¦
    for node in optimized["nodes"]:
        system_prompt = node.get("system_prompt", "")
        if len(system_prompt) > 1000:
            # æç¤ºç”¨æˆ·è€ƒè™‘ç®€åŒ–æç¤ºè¯
            print(f"è­¦å‘Š: èŠ‚ç‚¹ {node['id']} çš„ç³»ç»Ÿæç¤ºè¯è¾ƒé•¿ ({len(system_prompt)} å­—ç¬¦)")
    
    return optimized

def monitor_execution_performance(graph_name, input_text):
    """ç›‘æ§å›¾æ‰§è¡Œæ€§èƒ½"""
    import time
    import psutil
    
    # è®°å½•åˆå§‹çŠ¶æ€
    start_time = time.time()
    start_memory = psutil.Process().memory_info().rss / 1024 / 1024  # MB
    
    print(f"å¼€å§‹æ‰§è¡Œå›¾: {graph_name}")
    print(f"åˆå§‹å†…å­˜ä½¿ç”¨: {start_memory:.1f} MB")
    
    # æ‰§è¡Œå›¾
    result = mag.run_graph(graph_name, input_text)
    
    # è®°å½•ç»“æŸçŠ¶æ€
    end_time = time.time()
    end_memory = psutil.Process().memory_info().rss / 1024 / 1024  # MB
    
    execution_time = end_time - start_time
    memory_delta = end_memory - start_memory
    
    print(f"æ‰§è¡Œå®Œæˆï¼Œç”¨æ—¶: {execution_time:.2f} ç§’")
    print(f"å†…å­˜å˜åŒ–: {memory_delta:.1f} MB")
    
    # åˆ†æç»“æœ
    if result.get("status") == "success":
        output_length = len(result.get("output", ""))
        print(f"è¾“å‡ºé•¿åº¦: {output_length} å­—ç¬¦")
        print(f"å¤„ç†æ•ˆç‡: {output_length/execution_time:.1f} å­—ç¬¦/ç§’")
    
    return result, {
        "execution_time": execution_time,
        "memory_delta": memory_delta,
        "success": result.get("status") == "success"
    }

# ç¼“å­˜æœºåˆ¶
class GraphExecutionCache:
    """å›¾æ‰§è¡Œç»“æœç¼“å­˜"""
    
    def __init__(self):
        self.cache = {}
    
    def get_cache_key(self, graph_name, input_text):
        """ç”Ÿæˆç¼“å­˜é”®"""
        import hashlib
        key_string = f"{graph_name}:{input_text}"
        return hashlib.md5(key_string.encode()).hexdigest()
    
    def get(self, graph_name, input_text):
        """è·å–ç¼“å­˜ç»“æœ"""
        key = self.get_cache_key(graph_name, input_text)
        return self.cache.get(key)
    
    def set(self, graph_name, input_text, result):
        """è®¾ç½®ç¼“å­˜ç»“æœ"""
        key = self.get_cache_key(graph_name, input_text)
        self.cache[key] = result
        print(f"ç»“æœå·²ç¼“å­˜: {key[:8]}...")
    
    def clear(self):
        """æ¸…ç©ºç¼“å­˜"""
        self.cache.clear()

# ä½¿ç”¨ç¼“å­˜æ‰§è¡Œå›¾
cache = GraphExecutionCache()

def cached_run_graph(graph_name, input_text):
    """å¸¦ç¼“å­˜çš„å›¾æ‰§è¡Œ"""
    # æ£€æŸ¥ç¼“å­˜
    cached_result = cache.get(graph_name, input_text)
    if cached_result:
        print("âœ… ä½¿ç”¨ç¼“å­˜ç»“æœ")
        return cached_result
    
    # æ‰§è¡Œå›¾
    print("ğŸ”„ æ‰§è¡Œæ–°è®¡ç®—")
    result = mag.run_graph(graph_name, input_text)
    
    # ç¼“å­˜ç»“æœ
    if result.get("status") == "success":
        cache.set(graph_name, input_text, result)
    
    return result
</code></pre>
                    </div>
                </div>
            </section>

            <!-- æ•…éšœæ’é™¤ -->
            <section class="section" id="troubleshooting">
                <h2><i class="fas fa-wrench"></i> æ•…éšœæ’é™¤</h2>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-bug"></i>
                        </div>
                        <div class="example-title">å¸¸è§é—®é¢˜è¯Šæ–­å’Œè§£å†³</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># æ•…éšœæ’é™¤å·¥å…·é›†

def diagnose_mag_system():
    """è¯Šæ–­MAGç³»ç»ŸçŠ¶æ€"""
    print("ğŸ” MAGç³»ç»Ÿè¯Šæ–­")
    print("=" * 50)
    
    # 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
    print("1. æœåŠ¡çŠ¶æ€æ£€æŸ¥:")
    is_running = mag.is_running()
    print(f"   æœåŠ¡è¿è¡ŒçŠ¶æ€: {'âœ… æ­£å¸¸' if is_running else 'âŒ æœªè¿è¡Œ'}")
    
    if not is_running:
        print("   å»ºè®®: è¿è¡Œ mag.start() å¯åŠ¨æœåŠ¡")
        return
    
    # 2. æ£€æŸ¥æ¨¡å‹é…ç½®
    print("\\n2. æ¨¡å‹é…ç½®æ£€æŸ¥:")
    try:
        models = mag.list_models()
        print(f"   å·²é…ç½®æ¨¡å‹æ•°é‡: {len(models)}")
        
        if not models:
            print("   âš ï¸  è­¦å‘Š: æœªé…ç½®ä»»ä½•æ¨¡å‹")
            print("   å»ºè®®: ä½¿ç”¨ mag.add_model() æ·»åŠ æ¨¡å‹")
        else:
            for model in models:
                has_api_key = bool(model.get("api_key"))
                print(f"   â€¢ {model['name']}: {'âœ…' if has_api_key else 'âŒ'} APIå¯†é’¥")
    except Exception as e:
        print(f"   âŒ è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥: {e}")
    
    # 3. æ£€æŸ¥MCPæœåŠ¡å™¨çŠ¶æ€
    print("\\n3. MCPæœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥:")
    try:
        mcp_status = mag.get_mcp_status()
        total_servers = len(mcp_status)
        connected_servers = sum(1 for status in mcp_status.values() 
                               if status.get("connected", False))
        
        print(f"   æ€»æœåŠ¡å™¨æ•°: {total_servers}")
        print(f"   å·²è¿æ¥æœåŠ¡å™¨: {connected_servers}")
        
        if connected_servers < total_servers:
            print("   âš ï¸  éƒ¨åˆ†æœåŠ¡å™¨æœªè¿æ¥")
            print("   å»ºè®®: è¿è¡Œ mag.connect_mcp('all') è¿æ¥æ‰€æœ‰æœåŠ¡å™¨")
            
            # æ˜¾ç¤ºæœªè¿æ¥çš„æœåŠ¡å™¨
            for server_name, status in mcp_status.items():
                if not status.get("connected", False):
                    print(f"   â€¢ {server_name}: æœªè¿æ¥")
    except Exception as e:
        print(f"   âŒ è·å–MCPçŠ¶æ€å¤±è´¥: {e}")
    
    # 4. æ£€æŸ¥å›¾é…ç½®
    print("\\n4. å›¾é…ç½®æ£€æŸ¥:")
    try:
        graphs = mag.list_graphs()
        print(f"   å¯ç”¨å›¾æ•°é‡: {len(graphs)}")
        
        if graphs:
            for graph_name in graphs[:5]:  # åªæ˜¾ç¤ºå‰5ä¸ª
                try:
                    graph_config = mag.get_graph(graph_name)
                    node_count = len(graph_config.get("nodes", []))
                    print(f"   â€¢ {graph_name}: {node_count} ä¸ªèŠ‚ç‚¹")
                except Exception as e:
                    print(f"   â€¢ {graph_name}: âŒ é…ç½®é”™è¯¯ - {e}")
        else:
            print("   â„¹ï¸  æ²¡æœ‰å¯ç”¨çš„å›¾")
    except Exception as e:
        print(f"   âŒ è·å–å›¾åˆ—è¡¨å¤±è´¥: {e}")
    
    print("\\nâœ… è¯Šæ–­å®Œæˆ")

def fix_common_issues():
    """ä¿®å¤å¸¸è§é—®é¢˜"""
    print("ğŸ”§ è‡ªåŠ¨ä¿®å¤å¸¸è§é—®é¢˜")
    print("=" * 50)
    
    # 1. å°è¯•å¯åŠ¨æœåŠ¡
    if not mag.is_running():
        print("1. å°è¯•å¯åŠ¨MAGæœåŠ¡...")
        if mag.start():
            print("   âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ")
        else:
            print("   âŒ æœåŠ¡å¯åŠ¨å¤±è´¥")
            print("   å»ºè®®: æ£€æŸ¥ç«¯å£å ç”¨æˆ–æƒé™é—®é¢˜")
            return
    
    # 2. å°è¯•è¿æ¥MCPæœåŠ¡å™¨
    print("\\n2. å°è¯•è¿æ¥MCPæœåŠ¡å™¨...")
    try:
        result = mag.connect_mcp("all")
        if result.get("status") in ["success", "partial_success"]:
            print("   âœ… MCPæœåŠ¡å™¨è¿æ¥æˆåŠŸ")
        else:
            print(f"   âš ï¸  è¿æ¥ç»“æœ: {result}")
    except Exception as e:
        print(f"   âŒ è¿æ¥å¤±è´¥: {e}")
    
    # 3. æ¸…ç†æ— æ•ˆä¼šè¯
    print("\\n3. æ¸…ç†æ— æ•ˆä¼šè¯...")
    try:
        conversations = mag.list_conversations()
        invalid_conversations = []
        
        for conv_id in conversations:
            try:
                mag.get_conversation(conv_id)
            except Exception:
                invalid_conversations.append(conv_id)
        
        if invalid_conversations:
            print(f"   å‘ç° {len(invalid_conversations)} ä¸ªæ— æ•ˆä¼šè¯")
            for conv_id in invalid_conversations:
                try:
                    mag.delete_conversation(conv_id)
                    print(f"   âœ… å·²åˆ é™¤: {conv_id}")
                except Exception as e:
                    print(f"   âŒ åˆ é™¤å¤±è´¥: {conv_id} - {e}")
        else:
            print("   âœ… æ²¡æœ‰æ— æ•ˆä¼šè¯")
    except Exception as e:
        print(f"   âŒ æ¸…ç†è¿‡ç¨‹å‡ºé”™: {e}")
    
    print("\\nâœ… ä¿®å¤å®Œæˆ")

def test_basic_functionality():
    """æµ‹è¯•åŸºæœ¬åŠŸèƒ½"""
    print("ğŸ§ª åŸºæœ¬åŠŸèƒ½æµ‹è¯•")
    print("=" * 50)
    
    tests = [
        ("æœåŠ¡çŠ¶æ€", lambda: mag.is_running()),
        ("è·å–æ¨¡å‹åˆ—è¡¨", lambda: len(mag.list_models()) >= 0),
        ("è·å–å›¾åˆ—è¡¨", lambda: len(mag.list_graphs()) >= 0),
        ("è·å–MCPçŠ¶æ€", lambda: isinstance(mag.get_mcp_status(), dict)),
        ("è·å–ä¼šè¯åˆ—è¡¨", lambda: len(mag.list_conversations()) >= 0),
    ]
    
    passed = 0
    total = len(tests)
    
    for test_name, test_func in tests:
        try:
            result = test_func()
            if result:
                print(f"   âœ… {test_name}: é€šè¿‡")
                passed += 1
            else:
                print(f"   âŒ {test_name}: å¤±è´¥")
        except Exception as e:
            print(f"   âŒ {test_name}: å‡ºé”™ - {e}")
    
    print(f"\\nğŸ“Š æµ‹è¯•ç»“æœ: {passed}/{total} é€šè¿‡")
    
    if passed == total:
        print("ğŸ‰ æ‰€æœ‰åŸºæœ¬åŠŸèƒ½æ­£å¸¸!")
    else:
        print("âš ï¸  éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥é…ç½®")

# ä½¿ç”¨è¯Šæ–­å·¥å…·
if __name__ == "__main__":
    diagnose_mag_system()
    fix_common_issues() 
    test_basic_functionality()
</code></pre>
                    </div>
                </div>
            </section>

            <!-- é«˜çº§ç”¨æ³• -->
            <section class="section" id="advanced-usage">
                <h2><i class="fas fa-rocket"></i> é«˜çº§ç”¨æ³•</h2>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="example-title">å›¾åµŒå¥—å’Œç»„åˆæ¨¡å¼</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># é«˜çº§å›¾ç»„åˆæ¨¡å¼

class GraphOrchestrator:
    """å›¾ç¼–æ’å™¨ - ç®¡ç†å¤æ‚çš„å›¾ç»„åˆå’ŒåµŒå¥—"""
    
    def __init__(self):
        self.execution_history = []
        self.shared_context = {}
    
    def create_composite_workflow(self, workflow_name, sub_graphs):
        """åˆ›å»ºå¤åˆå·¥ä½œæµ"""
        print(f"åˆ›å»ºå¤åˆå·¥ä½œæµ: {workflow_name}")
        
        # åˆ›å»ºä¸»æ§åˆ¶å›¾
        main_graph = {
            "name": workflow_name,
            "description": f"å¤åˆå·¥ä½œæµåŒ…å« {len(sub_graphs)} ä¸ªå­å›¾",
            "nodes": [],
            "edges": [],
            "version": "1.0"
        }
        
        # ä¸ºæ¯ä¸ªå­å›¾åˆ›å»ºæ§åˆ¶èŠ‚ç‚¹
        for i, (sub_graph_name, config) in enumerate(sub_graphs.items()):
            node_id = f"sub_graph_{i}_{sub_graph_name}"
            
            # åˆ›å»ºå­å›¾æ‰§è¡ŒèŠ‚ç‚¹
            node = {
                "id": node_id,
                "name": f"æ‰§è¡Œ {sub_graph_name}",
                "type": "agent",
                "model_name": config.get("model", "gpt-4"),
                "system_prompt": f"""ä½ æ˜¯å­å›¾ {sub_graph_name} çš„æ‰§è¡Œæ§åˆ¶å™¨ã€‚
ä»»åŠ¡: æ ¹æ®è¾“å…¥å’Œä¸Šä¸‹æ–‡æ‰§è¡Œå­å›¾ï¼Œå¹¶æ•´ç†è¾“å‡ºç»“æœã€‚
è¦æ±‚: ç¡®ä¿æ•°æ®æ­£ç¡®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­å›¾ã€‚""",
                "user_prompt": config.get("prompt_template", "æ‰§è¡Œå­å›¾: {input}"),
                "mcp_servers": config.get("mcp_servers", []),
                "position": {"x": 200 * i, "y": 100},
                "metadata": {
                    "sub_graph": sub_graph_name,
                    "execution_order": i
                }
            }
            
            main_graph["nodes"].append(node)
            
            # åˆ›å»ºæ‰§è¡Œé“¾
            if i > 0:
                prev_node = f"sub_graph_{i-1}_{list(sub_graphs.keys())[i-1]}"
                main_graph["edges"].append({
                    "from": prev_node,
                    "to": node_id
                })
        
        return main_graph
    
    def execute_with_checkpoints(self, graph_name, input_text, checkpoint_interval=2):
        """å¸¦æ£€æŸ¥ç‚¹çš„å›¾æ‰§è¡Œ"""
        print(f"å¼€å§‹æ‰§è¡Œå›¾ {graph_name}ï¼Œæ£€æŸ¥ç‚¹é—´éš”: {checkpoint_interval}")
        
        # è·å–å›¾é…ç½®
        graph_config = mag.get_graph(graph_name)
        nodes = graph_config.get("nodes", [])
        
        results = {}
        checkpoint_data = {}
        
        for i, node in enumerate(nodes):
            node_id = node["id"]
            print(f"æ‰§è¡ŒèŠ‚ç‚¹: {node_id} ({i+1}/{len(nodes)})")
            
            try:
                # è¿™é‡Œç®€åŒ–ä¸ºç›´æ¥è¿è¡Œæ•´ä¸ªå›¾ï¼Œå®é™…å®ç°éœ€è¦èŠ‚ç‚¹çº§æ§åˆ¶
                if i == 0:
                    # ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨åŸå§‹è¾“å…¥
                    current_input = input_text
                else:
                    # åç»­èŠ‚ç‚¹ä½¿ç”¨å‰ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡º
                    prev_result = results.get(list(results.keys())[-1], {})
                    current_input = prev_result.get("output", "")
                
                # æ¨¡æ‹ŸèŠ‚ç‚¹æ‰§è¡Œï¼ˆå®é™…éœ€è¦æ›´å¤æ‚çš„å®ç°ï¼‰
                node_result = {
                    "status": "success",
                    "output": f"èŠ‚ç‚¹ {node_id} çš„è¾“å‡ºåŸºäº: {current_input[:100]}...",
                    "execution_time": time.time()
                }
                
                results[node_id] = node_result
                
                # åˆ›å»ºæ£€æŸ¥ç‚¹
                if (i + 1) % checkpoint_interval == 0:
                    checkpoint_data[f"checkpoint_{i+1}"] = {
                        "completed_nodes": list(results.keys()),
                        "timestamp": time.time(),
                        "last_output": node_result["output"]
                    }
                    print(f"âœ… æ£€æŸ¥ç‚¹å·²åˆ›å»º: checkpoint_{i+1}")
                
            except Exception as e:
                print(f"âŒ èŠ‚ç‚¹ {node_id} æ‰§è¡Œå¤±è´¥: {e}")
                # å¯ä»¥é€‰æ‹©å›æ»šåˆ°æœ€è¿‘çš„æ£€æŸ¥ç‚¹
                return self.rollback_to_checkpoint(checkpoint_data, results)
        
        return {
            "status": "success",
            "results": results,
            "checkpoints": checkpoint_data
        }
    
    def rollback_to_checkpoint(self, checkpoint_data, current_results):
        """å›æ»šåˆ°æœ€è¿‘çš„æ£€æŸ¥ç‚¹"""
        if not checkpoint_data:
            print("âŒ æ²¡æœ‰å¯ç”¨çš„æ£€æŸ¥ç‚¹")
            return {"status": "failed", "error": "No checkpoints available"}
        
        latest_checkpoint = max(checkpoint_data.keys())
        checkpoint = checkpoint_data[latest_checkpoint]
        
        print(f"ğŸ”„ å›æ»šåˆ°æ£€æŸ¥ç‚¹: {latest_checkpoint}")
        print(f"   å®Œæˆçš„èŠ‚ç‚¹: {checkpoint['completed_nodes']}")
        
        return {
            "status": "rollback",
            "checkpoint": latest_checkpoint,
            "completed_nodes": checkpoint["completed_nodes"],
            "last_output": checkpoint["last_output"]
        }

# åˆ›å»ºå¤åˆå·¥ä½œæµç¤ºä¾‹
orchestrator = GraphOrchestrator()

# å®šä¹‰å­å›¾é…ç½®
sub_graphs = {
    "data_collection": {
        "model": "gpt-3.5-turbo",
        "mcp_servers": ["fetch", "tavily-mcp"],
        "prompt_template": "æ”¶é›†æ•°æ®: {input}"
    },
    "data_analysis": {
        "model": "gpt-4", 
        "mcp_servers": [],
        "prompt_template": "åˆ†ææ•°æ®: {previous_output}"
    },
    "report_generation": {
        "model": "gpt-4",
        "mcp_servers": [],
        "prompt_template": "ç”ŸæˆæŠ¥å‘Š: {previous_output}"
    }
}

# åˆ›å»ºå¤åˆå·¥ä½œæµ
composite_graph = orchestrator.create_composite_workflow(
    "advanced_research_pipeline", 
    sub_graphs
)

# ä¿å­˜å¹¶æ‰§è¡Œ
mag.save_graph(composite_graph)
result = orchestrator.execute_with_checkpoints(
    "advanced_research_pipeline",
    "AIåœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨",
    checkpoint_interval=1
)
</code></pre>
                    </div>
                </div>

                <div class="example-card">
                    <div class="example-header">
                        <div class="example-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="example-title">åŠ¨æ€å›¾ç”Ÿæˆå’Œè‡ªé€‚åº”æ‰§è¡Œ</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                        <pre><code class="language-python"># åŠ¨æ€å›¾ç”Ÿæˆç³»ç»Ÿ

class DynamicGraphBuilder:
    """åŠ¨æ€å›¾æ„å»ºå™¨"""
    
    def __init__(self):
        self.template_library = {}
        self.load_templates()
    
    def load_templates(self):
        """åŠ è½½å›¾æ¨¡æ¿åº“"""
        self.template_library = {
            "search_analyze": {
                "description": "æœç´¢å¹¶åˆ†æä¿¡æ¯",
                "nodes": ["searcher", "analyzer"],
                "complexity": "simple"
            },
            "research_report": {
                "description": "å®Œæ•´ç ”ç©¶æµç¨‹",
                "nodes": ["searcher", "analyzer", "synthesizer", "reporter"],
                "complexity": "complex"
            },
            "content_creation": {
                "description": "å†…å®¹åˆ›ä½œæµç¨‹",
                "nodes": ["researcher", "outliner", "writer", "editor"],
                "complexity": "complex"
            }
        }
    
    def analyze_user_intent(self, user_request):
        """åˆ†æç”¨æˆ·æ„å›¾å¹¶æ¨èå›¾æ¨¡æ¿"""
        # ç®€åŒ–çš„æ„å›¾åˆ†æ
        intent_keywords = {
            "search": ["æœç´¢", "æŸ¥æ‰¾", "æ‰¾", "search", "find"],
            "analyze": ["åˆ†æ", "research", "ç ”ç©¶", "analyze"],
            "create": ["åˆ›å»º", "å†™", "ç”Ÿæˆ", "create", "generate"],
            "report": ["æŠ¥å‘Š", "æ€»ç»“", "report", "summary"]
        }
        
        detected_intents = []
        request_lower = user_request.lower()
        
        for intent, keywords in intent_keywords.items():
            if any(keyword in request_lower for keyword in keywords):
                detected_intents.append(intent)
        
        # æ¨èæ¨¡æ¿
        if "search" in detected_intents and "analyze" in detected_intents:
            if "report" in detected_intents:
                return "research_report"
            else:
                return "search_analyze"
        elif "create" in detected_intents:
            return "content_creation"
        else:
            return "search_analyze"  # é»˜è®¤
    
    def generate_graph_from_intent(self, user_request, template_name=None):
        """æ ¹æ®ç”¨æˆ·æ„å›¾åŠ¨æ€ç”Ÿæˆå›¾"""
        if not template_name:
            template_name = self.analyze_user_intent(user_request)
        
        template = self.template_library.get(template_name)
        if not template:
            raise ValueError(f"æœªæ‰¾åˆ°æ¨¡æ¿: {template_name}")
        
        print(f"æ ¹æ®æ„å›¾ç”Ÿæˆå›¾ï¼Œä½¿ç”¨æ¨¡æ¿: {template_name}")
        
        # ç”Ÿæˆå›¾é…ç½®
        graph_name = f"dynamic_{template_name}_{int(time.time())}"
        
        graph_config = {
            "name": graph_name,
            "description": f"åŠ¨æ€ç”Ÿæˆçš„å›¾: {template['description']}",
            "nodes": [],
            "edges": [],
            "version": "1.0",
            "metadata": {
                "generated": True,
                "template": template_name,
                "user_request": user_request
            }
        }
        
        # æ ¹æ®æ¨¡æ¿åˆ›å»ºèŠ‚ç‚¹
        node_configs = self.get_node_configs_for_template(template_name)
        
        for i, (node_type, config) in enumerate(node_configs.items()):
            node = {
                "id": f"{node_type}_{i}",
                "name": config["name"],
                "type": "agent",
                "model_name": config["model"],
                "system_prompt": config["system_prompt"],
                "user_prompt": config["user_prompt"],
                "mcp_servers": config.get("mcp_servers", []),
                "position": {"x": 200 * i, "y": 100}
            }
            graph_config["nodes"].append(node)
            
            # åˆ›å»ºè¿æ¥
            if i > 0:
                prev_node_id = f"{list(node_configs.keys())[i-1]}_{i-1}"
                graph_config["edges"].append({
                    "from": prev_node_id,
                    "to": node["id"]
                })
        
        return graph_config
    
    def get_node_configs_for_template(self, template_name):
        """è·å–æ¨¡æ¿çš„èŠ‚ç‚¹é…ç½®"""
        configs = {
            "search_analyze": {
                "searcher": {
                    "name": "ä¿¡æ¯æœç´¢",
                    "model": "gpt-3.5-turbo",
                    "system_prompt": "ä½ æ˜¯ä¿¡æ¯æœç´¢ä¸“å®¶ï¼Œè´Ÿè´£æ”¶é›†ç›¸å…³ä¿¡æ¯ã€‚",
                    "user_prompt": "æœç´¢: {input}",
                    "mcp_servers": ["tavily-mcp"]
                },
                "analyzer": {
                    "name": "ä¿¡æ¯åˆ†æ",
                    "model": "gpt-4",
                    "system_prompt": "ä½ æ˜¯æ•°æ®åˆ†æä¸“å®¶ï¼Œè´Ÿè´£åˆ†ææœç´¢ç»“æœã€‚",
                    "user_prompt": "åˆ†æ: {previous_output}",
                    "mcp_servers": []
                }
            },
            "research_report": {
                "searcher": {
                    "name": "ä¿¡æ¯æœç´¢",
                    "model": "gpt-3.5-turbo",
                    "system_prompt": "æœç´¢ç›¸å…³ä¿¡æ¯",
                    "user_prompt": "æœç´¢: {input}",
                    "mcp_servers": ["tavily-mcp"]
                },
                "analyzer": {
                    "name": "æ·±åº¦åˆ†æ",
                    "model": "gpt-4",
                    "system_prompt": "æ·±åº¦åˆ†ææœç´¢ç»“æœ",
                    "user_prompt": "åˆ†æ: {previous_output}",
                    "mcp_servers": []
                },
                "synthesizer": {
                    "name": "ä¿¡æ¯ç»¼åˆ",
                    "model": "gpt-4",
                    "system_prompt": "ç»¼åˆåˆ†æç»“æœ",
                    "user_prompt": "ç»¼åˆ: {previous_output}",
                    "mcp_servers": []
                },
                "reporter": {
                    "name": "æŠ¥å‘Šç”Ÿæˆ",
                    "model": "gpt-4",
                    "system_prompt": "ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š",
                    "user_prompt": "ç”ŸæˆæŠ¥å‘Š: {previous_output}",
                    "mcp_servers": []
                }
            }
        }
        
        return configs.get(template_name, {})
    
    def adaptive_execution(self, graph_name, input_text):
        """è‡ªé€‚åº”æ‰§è¡Œ - æ ¹æ®ä¸­é—´ç»“æœè°ƒæ•´åç»­èŠ‚ç‚¹"""
        print(f"å¼€å§‹è‡ªé€‚åº”æ‰§è¡Œ: {graph_name}")
        
        # è·å–å›¾é…ç½®
        graph_config = mag.get_graph(graph_name)
        
        # æ‰§è¡Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        result = mag.run_graph(graph_name, input_text)
        
        if result.get("status") != "success":
            return result
        
        # åˆ†æä¸­é—´ç»“æœï¼Œå†³å®šæ˜¯å¦éœ€è¦è°ƒæ•´
        output = result.get("output", "")
        
        # ç®€å•çš„è‡ªé€‚åº”é€»è¾‘
        if len(output) < 500:
            print("âš ï¸  è¾“å‡ºè¾ƒçŸ­ï¼Œå¯èƒ½éœ€è¦æ›´å¤šä¿¡æ¯")
            # å¯ä»¥é€‰æ‹©å¢åŠ æœç´¢èŠ‚ç‚¹æˆ–ä¿®æ”¹æç¤ºè¯
        elif "é”™è¯¯" in output or "å¤±è´¥" in output:
            print("âš ï¸  æ£€æµ‹åˆ°æ‰§è¡Œé—®é¢˜ï¼Œå»ºè®®å›æ»š")
        
        return result

# ä½¿ç”¨åŠ¨æ€å›¾ç”Ÿæˆå™¨
builder = DynamicGraphBuilder()

# ç”¨æˆ·è¯·æ±‚ç¤ºä¾‹
user_requests = [
    "æˆ‘æƒ³æœç´¢å¹¶åˆ†æäººå·¥æ™ºèƒ½çš„æœ€æ–°å‘å±•",
    "å¸®æˆ‘ç ”ç©¶åŒºå—é“¾æŠ€æœ¯å¹¶ç”Ÿæˆä¸€ä»½è¯¦ç»†æŠ¥å‘Š",
    "åˆ›å»ºä¸€ç¯‡å…³äºå¯æŒç»­èƒ½æºçš„æ–‡ç« "
]

for request in user_requests:
    print(f"\\nå¤„ç†ç”¨æˆ·è¯·æ±‚: {request}")
    
    # ç”ŸæˆåŠ¨æ€å›¾
    graph_config = builder.generate_graph_from_intent(request)
    print(f"ç”Ÿæˆå›¾: {graph_config['name']}")
    
    # ä¿å­˜å¹¶æ‰§è¡Œ
    mag.save_graph(graph_config)
    result = builder.adaptive_execution(graph_config['name'], request)
    
    if result.get("status") == "success":
        print("âœ… åŠ¨æ€å›¾æ‰§è¡ŒæˆåŠŸ")
    else:
        print(f"âŒ æ‰§è¡Œå¤±è´¥: {result.get('error')}")
</code></pre>
                    </div>
                </div>
            </section>

            <!-- æ€»ç»“ -->
            <section class="section">
                <div class="success">
                    <h4><i class="fas fa-graduation-cap"></i> å­¦ä¹ å®Œæˆ</h4>
                    <p>æ­å–œæ‚¨å®Œæˆäº†MAG SDKçš„å®Œæ•´æ•™ç¨‹ï¼æ‚¨ç°åœ¨å·²ç»æŒæ¡äº†ä»åŸºç¡€ä½¿ç”¨åˆ°é«˜çº§æŠ€å·§çš„å…¨éƒ¨å†…å®¹ã€‚å»ºè®®æ‚¨æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡å¼å¼€å§‹æ„å»ºæ‚¨çš„æ™ºèƒ½ä½“ç³»ç»Ÿã€‚</p>
                </div>

                <div class="note">
                    <h4><i class="fas fa-lightbulb"></i> ä¸‹ä¸€æ­¥å»ºè®®</h4>
                    <p>â€¢ ä»ç®€å•çš„å•èŠ‚ç‚¹å›¾å¼€å§‹å®è·µ<br>
                    â€¢ é€æ­¥å°è¯•å¤šèŠ‚ç‚¹å·¥ä½œæµ<br>
                    â€¢ æ¢ç´¢MCPæœåŠ¡å™¨çš„ä¸°å¯ŒåŠŸèƒ½<br>
                    â€¢ å‚ä¸ç¤¾åŒºè®¨è®ºå’Œè´¡çŒ®<br>
                    â€¢ å…³æ³¨é¡¹ç›®æ›´æ–°å’Œæ–°åŠŸèƒ½</p>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // å¤åˆ¶ä»£ç åŠŸèƒ½
        function copyCode(button) {
            const code = button.nextElementSibling.textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'å·²å¤åˆ¶!';
                button.style.background = '#10b981';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#4b5563';
                }, 2000);
            });
        }

        // ä»£ç é«˜äº®
        Prism.highlightAll();
    </script>
</body>
</html>