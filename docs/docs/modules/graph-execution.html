<div class="max-w-4xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Graph Execution</h1>
        <p class="text-lg text-gray-600">Learn how to execute graphs with different modes including the new background execution feature.</p>
    </div>

    <!-- Overview -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Execution Modes Overview</h2>
        <p class="text-gray-600 mb-6">MAG SDK provides three execution modes to suit different use cases:</p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Basic Mode -->
            <div class="border border-gray-200 rounded-lg p-4 bg-blue-50 border-blue-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-play text-white"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Basic Mode</h3>
                </div>
                <p class="text-sm text-gray-600 mb-3">Execute and wait for completion. Returns full result when done.</p>
                <div class="flex items-center text-sm text-gray-500">
                    <i class="fas fa-check-circle text-green-500 mr-1"></i>
                    <span>Simple & Reliable</span>
                </div>
            </div>

            <!-- Background Mode -->
            <div class="border border-gray-200 rounded-lg p-4 bg-green-50 border-green-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-clock text-white"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Background Mode</h3>
                    <span class="ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">New</span>
                </div>
                <p class="text-sm text-gray-600 mb-3">Start execution and continue immediately. Check results later.</p>
                <div class="flex items-center text-sm text-gray-500">
                    <i class="fas fa-rocket text-blue-500 mr-1"></i>
                    <span>Non-blocking</span>
                </div>
            </div>

            <!-- Streaming Mode -->
            <div class="border border-gray-200 rounded-lg p-4 bg-purple-50 border-purple-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-stream text-white"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Streaming Mode</h3>
                </div>
                <p class="text-sm text-gray-600 mb-3">Real-time updates during execution. Perfect for UI integration.</p>
                <div class="flex items-center text-sm text-gray-500">
                    <i class="fas fa-eye text-purple-500 mr-1"></i>
                    <span>Real-time</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Basic Execution -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">
            <i class="fas fa-play text-blue-600 mr-2"></i>
            Basic Execution
        </h2>
        <p class="text-gray-600 mb-4">The simplest way to execute a graph. The function blocks until completion and returns the full result.</p>

        <div class="api-method">
            <div class="api-method-header">
                <h3 class="method-name">mag.run_graph()</h3>
            </div>
            <div class="api-method-body">
                <div class="parameter-list">
                    <h4 class="font-semibold text-gray-900 mb-3">Parameters:</h4>
                    <div class="parameter">
                        <span class="param-name">name</span>
                        <span class="param-type">str</span>
                        <span class="param-description">Name of the graph to execute</span>
                    </div>
                    <div class="parameter">
                        <span class="param-name">input_text</span>
                        <span class="param-type">str</span>
                        <span class="param-description">Input text for the graph</span>
                    </div>
                    <div class="parameter">
                        <span class="param-name">stream</span>
                        <span class="param-type">bool</span>
                        <span class="param-description">Enable streaming mode (default: False)</span>
                    </div>
                    <div class="parameter">
                        <span class="param-name">background</span>
                        <span class="param-type">bool</span>
                        <span class="param-description">Enable background execution (default: False)</span>
                    </div>
                </div>

                <div class="example-block">
                    <div class="example-title">
                        <i class="fas fa-code"></i>
                        Basic Execution Example
                    </div>
                    <div class="bg-gray-50 rounded p-4 border relative group">
                        <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" onclick="copyToClipboard('import mag\n\n# Execute graph and wait for completion\nresult = mag.run_graph(\n    name=\"math_exam\",\n    input_text=\"Create a math test with 3 problems\",\n    stream=False,\n    background=False\n)\n\n# Access the results\nprint(f\"Conversation ID: {result.get(\"_id\")}\")\nprint(f\"Final Result: {result.get(\"final_result\")}\")\nprint(f\"Execution completed: {result.get(\"completed\")}\")\nprint(f\"Number of rounds: {len(result.get(\"rounds\", []))}\")')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre><code class="language-python">import mag

# Execute graph and wait for completion
result = mag.run_graph(
    name="math_exam",
    input_text="Create a math test with 3 problems",
    stream=False,
    background=False
)

# Access the results
print(f"Conversation ID: {result.get('_id')}")
print(f"Final Result: {result.get('final_result')}")
print(f"Execution completed: {result.get('completed')}")
print(f"Number of rounds: {len(result.get('rounds', []))}")</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Execution -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">
            <i class="fas fa-clock text-green-600 mr-2"></i>
            Background Execution
            <span class="bg-green-100 text-green-800 text-sm font-medium ml-3 px-2.5 py-0.5 rounded-full">New Feature</span>
        </h2>
        <p class="text-gray-600 mb-4">Execute graphs in the background without blocking your application. Perfect for long-running processes and batch jobs.</p>

        <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-lightbulb text-green-400"></i>
                </div>
                <div class="ml-3">
                    <h4 class="text-sm font-semibold text-green-800">Key Benefits</h4>
                    <ul class="mt-2 text-sm text-green-700 list-disc list-inside">
                        <li>Non-blocking execution - your application remains responsive</li>
                        <li>Immediate return with conversation ID</li>
                        <li>Scalable - handle multiple concurrent executions</li>
                        <li>Same execution logic as synchronous mode</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="api-method">
            <div class="api-method-header">
                <h3 class="method-name">Background Execution</h3>
            </div>
            <div class="api-method-body">
                <div class="example-block">
                    <div class="example-title">
                        <i class="fas fa-rocket"></i>
                        Start Background Execution
                    </div>
                    <div class="bg-gray-50 rounded p-4 border relative group mb-4">
                        <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" onclick="copyToClipboard('import mag\n\n# Start graph in background\nconversation_id = mag.run_graph(\n    name=\"data_processor\",\n    input_text=\"Process large dataset\",\n    background=True  # Key parameter for background execution\n)\n\nprint(f\"Graph started in background: {conversation_id}\")\nprint(\"You can continue with other tasks now...\")\n\n# Your application continues running normally\nprint(\"Doing other work while graph executes...\")')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre><code class="language-python">import mag

# Start graph in background
conversation_id = mag.run_graph(
    name="data_processor",
    input_text="Process large dataset",
    background=True  # Key parameter for background execution
)

print(f"Graph started in background: {conversation_id}")
print("You can continue with other tasks now...")

# Your application continues running normally
print("Doing other work while graph executes...")</code></pre>
                    </div>
                </div>

                <div class="example-block">
                    <div class="example-title">
                        <i class="fas fa-search"></i>
                        Check Execution Status
                    </div>
                    <div class="bg-gray-50 rounded p-4 border relative group mb-4">
                        <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" onclick="copyToClipboard('# Check if execution is complete\nresult = mag.get_conversation_detail(conversation_id)\n\nif result.get(\"completed\"):\n    print(\"✅ Execution completed!\")\n    print(f\"Final result: {result.get(\"final_result\")}\")\n    print(f\"Duration: {result.get(\"duration\", \"Unknown\")}\")\nelse:\n    print(\"🔄 Still running...\")\n    print(f\"Current status: {result.get(\"status\", \"Unknown\")}\")\n    \n    # Check latest activity\n    rounds = result.get(\"rounds\", [])\n    if rounds:\n        latest_round = rounds[-1]\n        print(f\"Latest node: {latest_round.get(\"node_name\")}\")')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre><code class="language-python"># Check if execution is complete
result = mag.get_conversation_detail(conversation_id)

if result.get("completed"):
    print("✅ Execution completed!")
    print(f"Final result: {result.get('final_result')}")
    print(f"Duration: {result.get('duration', 'Unknown')}")
else:
    print("🔄 Still running...")
    print(f"Current status: {result.get('status', 'Unknown')}")

    # Check latest activity
    rounds = result.get("rounds", [])
    if rounds:
        latest_round = rounds[-1]
        print(f"Latest node: {latest_round.get('node_name')}")</code></pre>
                    </div>
                </div>

                <div class="example-block">
                    <div class="example-title">
                        <i class="fas fa-sync-alt"></i>
                        Poll for Completion
                    </div>
                    <div class="bg-gray-50 rounded p-4 border relative group">
                        <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" onclick="copyToClipboard('import time\n\ndef wait_for_completion(conversation_id, check_interval=5):\n    \"\"\"Wait for graph execution to complete\"\"\"\n    print(f\"Waiting for completion of {conversation_id}...\")\n    \n    while True:\n        result = mag.get_conversation_detail(conversation_id)\n        \n        if result.get(\"completed\"):\n            print(\"✅ Execution completed!\")\n            return result\n        \n        if result.get(\"error\"):\n            print(f\"❌ Execution failed: {result.get(\"error\")}\")\n            return result\n        \n        print(\"🔄 Still running... checking again in {} seconds\".format(check_interval))\n        time.sleep(check_interval)\n\n# Usage\nresult = wait_for_completion(conversation_id)\nprint(f\"Final result: {result.get(\"final_result\")}\")')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre><code class="language-python">import time

def wait_for_completion(conversation_id, check_interval=5):
    """Wait for graph execution to complete"""
    print(f"Waiting for completion of {conversation_id}...")

    while True:
        result = mag.get_conversation_detail(conversation_id)

        if result.get("completed"):
            print("✅ Execution completed!")
            return result

        if result.get("error"):
            print(f"❌ Execution failed: {result.get('error')}")
            return result

        print("🔄 Still running... checking again in {} seconds".format(check_interval))
        time.sleep(check_interval)

# Usage
result = wait_for_completion(conversation_id)
print(f"Final result: {result.get('final_result')}")</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Streaming Execution -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibent text-gray-900 mb-4">
            <i class="fas fa-stream text-purple-600 mr-2"></i>
            Streaming Execution
        </h2>
        <p class="text-gray-600 mb-4">Get real-time updates during graph execution. Ideal for user interfaces and monitoring applications.</p>

        <div class="example-block">
            <div class="example-title">
                <i class="fas fa-play-circle"></i>
                Streaming Example
            </div>
            <div class="bg-gray-50 rounded p-4 border relative group">
                <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" onclick="copyToClipboard('import mag\n\n# Start streaming execution\nresponse = mag.run_graph(\n    name=\"content_generator\",\n    input_text=\"Write a blog post about AI\",\n    stream=True,\n    background=False\n)\n\nconversation_id = None\ncurrent_node = None\n\n# Process streaming updates\nfor chunk in response:\n    # Conversation created\n    if chunk.get(\"type\") == \"conversation_created\":\n        conversation_id = chunk.get(\"conversation_id\")\n        print(f\"📝 Started: {conversation_id}\")\n    \n    # Node execution started\n    elif chunk.get(\"type\") == \"node_start\":\n        current_node = chunk.get(\"node_name\")\n        print(f\"\\n🔧 Starting node: {current_node}\")\n    \n    # AI content streaming\n    elif chunk.get(\"choices\"):\n        delta = chunk[\"choices\"][0].get(\"delta\", {})\n        \n        if delta.get(\"content\"):\n            print(delta[\"content\"], end=\"\", flush=True)\n    \n    # Tool execution\n    elif chunk.get(\"role\") == \"tool\":\n        tool_content = chunk.get(\"content\", \"\")\n        print(f\"\\n🛠️ Tool result: {tool_content[:100]}...\")\n    \n    # Node completed\n    elif chunk.get(\"type\") == \"node_end\":\n        print(f\"\\n✅ Completed node: {chunk.get(\"node_name\")}\")\n    \n    # Graph completed\n    elif chunk.get(\"type\") == \"graph_complete\":\n        print(\"\\n🎉 Graph execution completed!\")\n        break\n\nprint(f\"\\nFinal conversation ID: {conversation_id}\")')">
                    <i class="fas fa-copy"></i>
                </button>
                <pre><code class="language-python">import mag

# Start streaming execution
response = mag.run_graph(
    name="content_generator",
    input_text="Write a blog post about AI",
    stream=True,
    background=False
)

conversation_id = None
current_node = None

# Process streaming updates
for chunk in response:
    # Conversation created
    if chunk.get("type") == "conversation_created":
        conversation_id = chunk.get("conversation_id")
        print(f"📝 Started: {conversation_id}")

    # Node execution started
    elif chunk.get("type") == "node_start":
        current_node = chunk.get("node_name")
        print(f"\n🔧 Starting node: {current_node}")

    # AI content streaming
    elif chunk.get("choices"):
        delta = chunk["choices"][0].get("delta", {})

        if delta.get("content"):
            print(delta["content"], end="", flush=True)

    # Tool execution
    elif chunk.get("role") == "tool":
        tool_content = chunk.get("content", "")
        print(f"\n🛠️ Tool result: {tool_content[:100]}...")

    # Node completed
    elif chunk.get("type") == "node_end":
        print(f"\n✅ Completed node: {chunk.get('node_name')}")

    # Graph completed
    elif chunk.get("type") == "graph_complete":
        print("\n🎉 Graph execution completed!")
        break

print(f"\nFinal conversation ID: {conversation_id}")</code></pre>
            </div>
        </div>
    </div>

    <!-- Best Practices -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Best Practices</h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Do's -->
            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                <h3 class="font-semibold text-green-900 mb-3">
                    <i class="fas fa-check-circle text-green-600 mr-2"></i>
                    Do's
                </h3>
                <ul class="space-y-2 text-sm text-green-800">
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mr-2 mt-1"></i>
                        <span>Use background execution for long-running graphs</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mr-2 mt-1"></i>
                        <span>Use streaming for real-time user interfaces</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mr-2 mt-1"></i>
                        <span>Store conversation IDs for later result retrieval</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mr-2 mt-1"></i>
                        <span>Handle errors gracefully in all modes</span>
                    </li>
                </ul>
            </div>

            <!-- Don'ts -->
            <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                <h3 class="font-semibold text-red-900 mb-3">
                    <i class="fas fa-times-circle text-red-600 mr-2"></i>
                    Don'ts
                </h3>
                <ul class="space-y-2 text-sm text-red-800">
                    <li class="flex items-start">
                        <i class="fas fa-times text-red-600 mr-2 mt-1"></i>
                        <span>Don't use basic mode for very long graphs</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-times text-red-600 mr-2 mt-1"></i>
                        <span>Don't ignore error handling in streaming mode</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-times text-red-600 mr-2 mt-1"></i>
                        <span>Don't poll too frequently (< 1 second intervals)</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-times text-red-600 mr-2 mt-1"></i>
                        <span>Don't forget to handle conversation cleanup</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Performance Considerations -->
    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-lg">
        <h3 class="text-lg font-semibold text-blue-900 mb-3">
            <i class="fas fa-tachometer-alt text-blue-600 mr-2"></i>
            Performance Considerations
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800">
            <div>
                <h4 class="font-medium mb-2">Background Execution</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>No HTTP connection overhead</li>
                    <li>Higher concurrency supported</li>
                    <li>Minimal memory footprint</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium mb-2">Streaming Execution</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Real-time feedback</li>
                    <li>Higher bandwidth usage</li>
                    <li>Maintains HTTP connection</li>
                </ul>
            </div>
        </div>
    </div>
</div>