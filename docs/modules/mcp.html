<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP管理 - MAG SDK</title>

    <link href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link id="highlight-theme" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" rel="stylesheet">
    <link href="./shared.css" rel="stylesheet">

</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">
            <i class="fas fa-server mr-3 text-blue-600"></i>MCP管理
        </h1>

        <p class="text-lg mb-8" style="color: var(--text-muted)">
            MAG SDK 提供了完整的MCP（Model Context Protocol）服务器管理功能，包括配置管理、连接控制、工具调用和AI生成等。
        </p>

        <!-- 配置管理 -->
        <div class="method-card p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-cog mr-2 text-green-600"></i>配置管理
            </h2>

            <h3 class="text-xl font-medium mb-3">获取MCP配置</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def get_mcp_config() -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 获取当前MCP配置
config = mag.get_mcp_config()
print("MCP配置:", config)</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">更新MCP配置</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def update_mcp_config(config: Dict[str, Any]) -> Dict[str, Dict[str, Any]]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 更新MCP配置
new_config = {
    "mcpServers": {
        "filesystem": {
            "command": "npx",
            "args": ["@modelcontextprotocol/server-filesystem", "/path/to/directory"]
        }
    }
}
result = mag.update_mcp_config(new_config)
print("更新结果:", result)</code></pre>
            </div>
        </div>

        <!-- 服务器管理 -->
        <div class="method-card p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-server mr-2 text-blue-600"></i>服务器管理
            </h2>

            <h3 class="text-xl font-medium mb-3">添加MCP服务器</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def add_mcp(servers: Dict[str, Any]) -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 添加文件系统MCP服务器
servers_config = {
    "mcpServers": {
        "filesystem": {
            "command": "npx",
            "args": ["@modelcontextprotocol/server-filesystem", "/Users/username/Desktop"]
        },
        "brave-search": {
            "command": "npx",
            "args": ["@modelcontextprotocol/server-brave-search"],
            "env": {
                "BRAVE_API_KEY": "your-brave-api-key"
            }
        }
    }
}

result = mag.add_mcp(servers_config)
print("添加结果:", result)</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">删除MCP服务器</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def remove_mcp(names: Union[str, List[str]]) -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 删除单个服务器
result = mag.remove_mcp("filesystem")
print("删除结果:", result)

# 批量删除服务器
result = mag.remove_mcp(["server1", "server2", "server3"])
print("批量删除结果:", result)</code></pre>
            </div>
        </div>

        <!-- 连接管理 -->
        <div class="method-card p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-link mr-2 text-purple-600"></i>连接管理
            </h2>

            <h3 class="text-xl font-medium mb-3">连接服务器</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def connect(server_name: str) -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 连接指定服务器
result = mag.connect("filesystem")
print("连接结果:", result)

# 连接所有服务器
result = mag.connect("all")
print("连接所有服务器:", result)</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">断开连接</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def disconnect(server_name: str) -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 断开指定服务器
result = mag.disconnect("filesystem")
print("断开连接结果:", result)</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">查看连接状态</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def mcp_status() -> Dict[str, Dict[str, Any]]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 查看所有服务器状态
status = mag.mcp_status()
for server_name, server_status in status.items():
    print(f"服务器 {server_name}: {server_status}")
    print(f"  状态: {'已连接' if server_status.get('connected') else '未连接'}")
    print(f"  工具数量: {len(server_status.get('tools', []))}")
    print("---")</code></pre>
            </div>
        </div>

        <!-- 工具管理 -->
        <div class="method-card p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-tools mr-2 text-orange-600"></i>工具管理
            </h2>

            <h3 class="text-xl font-medium mb-3">获取可用工具</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def mcptools() -> Dict[str, List[Dict[str, Any]]]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 获取所有可用工具
tools = mag.mcptools()
for server_name, tool_list in tools.items():
    print(f"服务器 {server_name}:")
    for tool in tool_list:
        print(f"  - {tool['name']}: {tool['description']}")
    print("---")</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">测试工具调用</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def test_mcptool(server_name: str, tool_name: str, params: Dict[str, Any] = None) -> Dict[str, Any]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 测试文件系统读取工具
params = {
    "path": "/Users/username/Desktop/test.txt"
}
result = mag.test_mcptool("filesystem", "read_file", params)
print("工具调用结果:", result)

# 测试搜索工具
search_params = {
    "query": "Python programming"
}
search_result = mag.test_mcptool("brave-search", "brave_web_search", search_params)
print("搜索结果:", search_result)</code></pre>
            </div>
        </div>

        <!-- AI生成MCP -->
        <div class="method-card p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-magic mr-2 text-indigo-600"></i>AI生成MCP
            </h2>

            <h3 class="text-xl font-medium mb-3">获取生成提示词</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def mcp_gen_prompt() -> Dict[str, str]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 获取MCP生成提示词
prompt_info = mag.mcp_gen_prompt()
print("提示词模板:", prompt_info["template"])
print("使用说明:", prompt_info["instructions"])</code></pre>
            </div>

            <h3 class="text-xl font-medium mb-3">AI生成MCP工具</h3>
            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">函数签名</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">def gen_mcp(requirement: str, model: str, conversation_id: str,
           user_id: str = "default_user", stream: bool = True) -> Union[Dict[str, Any], Iterator[Dict[str, Any]]]</code></pre>
            </div>

            <div class="code-block mb-4">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">使用示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 非流式生成
requirement = "创建一个可以计算数学表达式的MCP工具"
result = mag.gen_mcp(
    requirement=requirement,
    model="gpt-4",
    conversation_id="math_mcp_gen_001",
    stream=False
)
print("生成结果:", result)

# 流式生成
for chunk in mag.gen_mcp(
    requirement=requirement,
    model="gpt-4",
    conversation_id="math_mcp_gen_002",
    stream=True
):
    if chunk.get("type") == "content":
        print(chunk.get("content", ""), end="")
    elif chunk.get("type") == "status":
        print(f"\n状态: {chunk.get('message')}")
</code></pre>
            </div>
        </div>

        <!-- 完整示例 -->
        <div class="method-card p-6">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-code mr-2 text-red-600"></i>完整示例
            </h2>

            <p class="mb-4" style="color: var(--text-secondary)">
                以下是一个完整的MCP管理示例，展示了从配置到使用的完整流程：
            </p>

            <div class="code-block">
                <div class="flex justify-between items-center p-3 border-b border-gray-200">
                    <span class="text-sm font-medium text-gray-600">完整示例</span>
                    <button class="copy-btn px-3 py-1 text-xs rounded" onclick="copyCode(this)">复制</button>
                </div>
                <pre class="p-4 overflow-x-auto"><code class="language-python">import mag

# 启动服务
mag.start()

# 1. 查看当前MCP配置
print("=== 当前MCP配置 ===")
current_config = mag.get_mcp_config()
print(current_config)

# 2. 添加新的MCP服务器
print("\n=== 添加MCP服务器 ===")
servers_to_add = {
    "mcpServers": {
        "filesystem": {
            "command": "npx",
            "args": ["@modelcontextprotocol/server-filesystem", "/Users/username/Desktop"]
        },
        "brave-search": {
            "command": "npx",
            "args": ["@modelcontextprotocol/server-brave-search"],
            "env": {
                "BRAVE_API_KEY": "your-api-key"
            }
        }
    }
}

add_result = mag.add_mcp(servers_to_add)
print(f"添加结果: {add_result}")

# 3. 连接所有服务器
print("\n=== 连接服务器 ===")
connect_result = mag.connect("all")
print(f"连接结果: {connect_result}")

# 4. 查看服务器状态
print("\n=== 服务器状态 ===")
status = mag.mcp_status()
for server_name, server_info in status.items():
    connected = server_info.get('connected', False)
    print(f"{server_name}: {'✓ 已连接' if connected else '✗ 未连接'}")

# 5. 获取可用工具
print("\n=== 可用工具 ===")
tools = mag.mcptools()
for server_name, tool_list in tools.items():
    print(f"\n{server_name} 服务器工具:")
    for tool in tool_list:
        print(f"  - {tool['name']}: {tool.get('description', 'No description')}")

# 6. 测试工具调用
print("\n=== 测试工具调用 ===")
try:
    # 测试文件系统工具（如果可用）
    if "filesystem" in tools and tools["filesystem"]:
        test_params = {"path": "/Users/username/Desktop"}
        test_result = mag.test_mcptool("filesystem", "list_directory", test_params)
        print(f"文件系统测试结果: {test_result}")
except Exception as e:
    print(f"工具测试失败: {e}")

# 7. AI生成新的MCP工具（可选）
print("\n=== AI生成MCP ===")
try:
    requirement = "创建一个简单的天气查询MCP工具"
    gen_result = mag.gen_mcp(
        requirement=requirement,
        model="gpt-4",
        conversation_id="weather_mcp_gen",
        stream=False
    )
    print(f"MCP生成结果: {gen_result}")
except Exception as e:
    print(f"MCP生成失败: {e}")

print("\n=== MCP管理完成 ===")
</code></pre>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="./shared.js"></script>
</body>
</html>